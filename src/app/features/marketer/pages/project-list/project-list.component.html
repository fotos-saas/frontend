<div class="project-list-page page-card">
  <header class="page-header">
    <div class="header-content">
      <h1>Projektek</h1>
      <p class="subtitle">{{ totalProjects() }} projekt √∂sszesen</p>
    </div>
    <app-add-button
      [label]="'√öj projekt'"
      [variant]="'primary'"
      (clicked)="createProject()"
    />
  </header>

  <!-- Keres√©s -->
  <div class="filters">
    <div class="search-box">
      <lucide-icon [name]="ICONS.SEARCH" class="search-icon" [size]="16" />
      <input
        type="text"
        placeholder="Keres√©s iskola vagy oszt√°ly neve alapj√°n..."
        [ngModel]="filterState.search()"
        (ngModelChange)="filterState.setSearch($event)"
        class="search-input"
      />
      @if (filterState.search()) {
        <button class="clear-btn" (click)="filterState.clearSearch()">
          <lucide-icon [name]="ICONS.X" [size]="14" />
        </button>
      }
    </div>

    <div class="filter-controls">
      <select [ngModel]="filterState.sortBy()" (ngModelChange)="filterState.setSortBy($event)" class="filter-select">
        <option value="created_at">L√©trehoz√°s d√°tuma</option>
        <option value="class_year">√âvfolyam</option>
      </select>

      <button class="sort-dir-btn" (click)="filterState.toggleSortDir()">
        <lucide-icon [name]="filterState.sortDir() === 'desc' ? ICONS.ARROW_DOWN : ICONS.ARROW_UP" [size]="16" />
      </button>
    </div>
  </div>

  <!-- Lista -->
  @if (filterState.loading()) {
    <div class="loading-state">
      @for (i of [1, 2, 3, 4, 5]; track i) {
        <div class="project-row skeleton skeleton-shimmer"></div>
      }
    </div>
  } @else if (projects().length === 0) {
    <div class="empty-state">
      <span class="empty-icon">üì≠</span>
      <h3>Nincs tal√°lat</h3>
      <p>Pr√≥b√°lj m√°s keres√©si felt√©telekkel!</p>
    </div>
  } @else {
    <!-- T√°bl√°zat fejl√©c -->
    <div class="table-header">
      <div class="col-school">Iskola / Oszt√°ly</div>
      <div class="col-contact">Kapcsolattart√≥</div>
      <div class="col-actions">M≈±veletek</div>
    </div>

    <!-- Projekt sorok -->
    <div class="project-list">
      @for (project of projects(); track project.id; let i = $index) {
        <div
          class="project-row"
          [style.animation-delay]="i * 0.03 + 's'"
          (click)="viewProject(project)"
        >
          <div class="col-school">
            <span class="school-name">{{ project.schoolName ?? 'Ismeretlen iskola' }}</span>
            <span class="class-info">
              {{ project.className }} {{ project.classYear }}
            </span>
          </div>

          <div class="col-contact">
            @if (project.contact) {
              <span class="contact-name">{{ project.contact.name }}</span>
              <span class="contact-email">{{ project.contact.email }}</span>
            } @else {
              <span class="no-contact">-</span>
            }
          </div>

          <div class="col-actions" (click)="$event.stopPropagation()">
            <app-qr-button
              [isActive]="project.hasActiveQrCode"
              [variant]="'icon-only'"
              (clicked)="openQrModal(project)"
            />
          </div>
        </div>
      }
    </div>

    <!-- Pagin√°l√°s -->
    @if (totalPages() > 1) {
      <div class="pagination">
        <button
          class="page-btn"
          [disabled]="filterState.page() === 1"
          (click)="goToPage(filterState.page() - 1)"
        >
          ‚Üê El≈ëz≈ë
        </button>

        <div class="page-info">
          {{ filterState.page() }} / {{ totalPages() }} oldal
          <span class="total-count">({{ totalProjects() }} projekt)</span>
        </div>

        <button
          class="page-btn"
          [disabled]="filterState.page() === totalPages()"
          (click)="goToPage(filterState.page() + 1)"
        >
          K√∂vetkez≈ë ‚Üí
        </button>
      </div>
    }
  }
</div>

<!-- QR Code Modal -->
@if (showQrModal()) {
  <app-shared-qr-code-modal
    [projectId]="selectedProjectId()!"
    [projectName]="selectedProjectName()"
    [qrService]="qrService"
    (close)="closeQrModal()"
    (qrCodeChanged)="onQrCodeChanged()"
  />
}
