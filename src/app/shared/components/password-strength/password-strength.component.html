<div class="password-strength" [class.password-strength--compact]="compact()">
  <!-- Strength bar -->
  <div class="strength-bar-container">
    <div
      class="strength-bar"
      [style.width.%]="strengthPercent()"
      [class]="strengthClass()"
    ></div>
  </div>

  <!-- Compact mode: inline label + tooltip -->
  @if (compact()) {
    <div class="strength-compact">
      <span class="strength-label" [class]="strengthClass()">
        {{ strengthLabel() }}
      </span>

      <!-- Tooltip trigger -->
      <div class="strength-tooltip-wrapper">
        <button
          type="button"
          class="strength-info-btn"
          aria-label="Jelszó követelmények"
          aria-describedby="password-requirements"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.94 6.94a.75.75 0 11-1.061-1.061 3 3 0 112.871 5.026v.345a.75.75 0 01-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 108.94 6.94zM10 15a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
          </svg>
        </button>

        <!-- Tooltip content -->
        <div class="strength-tooltip" id="password-requirements" role="tooltip">
          <div class="strength-tooltip__arrow"></div>
          <ul class="strength-tooltip__list">
            @for (req of requirements; track req.label) {
              <li [class.met]="req.validator(password())">
                <span class="icon">
                  @if (req.validator(password())) {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                    </svg>
                  } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                    </svg>
                  }
                </span>
                {{ req.label }}
              </li>
            }
          </ul>
        </div>
      </div>
    </div>
  } @else {
    <!-- Default mode: label + full requirements list -->
    <div class="strength-label" [class]="strengthClass()">
      {{ strengthLabel() }}
    </div>

    <ul class="requirements-list">
      @for (req of requirements; track req.label) {
        <li [class.met]="req.validator(password())">
          <span class="icon">
            @if (req.validator(password())) {
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
              </svg>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
              </svg>
            }
          </span>
          {{ req.label }}
        </li>
      }
    </ul>
  }
</div>
