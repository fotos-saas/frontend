<div class="missing-persons page-card" *ngIf="project$ | async as project">
  <main id="main-content" class="missing-persons__main" tabindex="-1">
    <!-- Page Header -->
    <header class="missing-persons__header">
      <h1 class="missing-persons__title">Hi√°nyz√≥ k√©pek</h1>
      <p class="missing-persons__subtitle">Az al√°bbi szem√©lyeknek m√©g nincs felt√∂ltve a k√©p√ºk</p>
    </header>

    <ng-container *ngIf="filteredPersons$ | async as data">
      <!-- Stats Banner -->
      <div class="stats-banner" *ngIf="project.missingStats?.withoutPhoto as totalMissing">
        <div class="stats-banner__icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
          </svg>
        </div>
        <div class="stats-banner__content">
          <span class="stats-banner__count">{{ totalMissing }} szem√©lynek nincs k√©pe</span>
          <span class="stats-banner__details">
            {{ data.studentsWithoutPhoto }} di√°k
            <span *ngIf="data.teachersWithoutPhoto > 0"> ‚Ä¢ {{ data.teachersWithoutPhoto }} tan√°r</span>
          </span>
        </div>
      </div>

      <!-- Empty State - All photos uploaded -->
      <div class="empty-state empty-state--success" *ngIf="project.missingStats?.withoutPhoto === 0">
        <div class="empty-state__icon empty-state__icon--success">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <h2 class="empty-state__title">Minden szem√©lynek van k√©pe!</h2>
        <p class="empty-state__text">A tabl√≥ k√©sz√≠t√©se megkezd≈ëdhet</p>
      </div>

      <!-- Search and Filter -->
      <div class="controls" *ngIf="project.missingStats && project.missingStats.withoutPhoto > 0">
        <div class="controls__search">
          <svg class="controls__search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
          </svg>
          <input
            type="text"
            class="controls__input"
            placeholder="Keres√©s n√©v szerint..."
            (input)="onSearchChange($event)"
            autocomplete="off"
          />
        </div>
        <select class="controls__filter" (change)="onFilterChange($event)">
          <option value="all">Mind</option>
          <option value="student">Csak di√°kok</option>
          <option value="teacher">Csak tan√°rok</option>
        </select>
      </div>

      <!-- Students Section -->
      <section class="person-section" *ngIf="data.students.length > 0">
        <div class="person-section__header">
          <span class="person-section__emoji">üë®‚Äçüéì</span>
          <h2 class="person-section__title">Di√°kok</h2>
          <span class="person-section__count">{{ data.students.length }} f≈ë</span>
        </div>
        <div class="person-grid">
          <div class="person-card" *ngFor="let person of data.students; trackBy: trackByPerson">
            <div class="person-card__avatar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
              </svg>
              <span class="person-card__badge"></span>
            </div>
            <div class="person-card__info">
              <span class="person-card__name">{{ person.name }}</span>
              <span class="person-card__id" *ngIf="person.localId">{{ person.localId }}</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Teachers Section -->
      <section class="person-section" *ngIf="data.teachers.length > 0">
        <div class="person-section__header">
          <span class="person-section__emoji">üë®‚Äçüè´</span>
          <h2 class="person-section__title">Tan√°rok</h2>
          <span class="person-section__count">{{ data.teachers.length }} f≈ë</span>
        </div>
        <div class="person-grid">
          <div class="person-card person-card--teacher" *ngFor="let person of data.teachers; trackBy: trackByPerson">
            <div class="person-card__avatar person-card__avatar--teacher">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
              </svg>
              <span class="person-card__badge person-card__badge--teacher"></span>
            </div>
            <div class="person-card__info">
              <span class="person-card__name">{{ person.name }}</span>
              <span class="person-card__id" *ngIf="person.localId">{{ person.localId }}</span>
            </div>
          </div>
        </div>
      </section>

      <!-- No Results State -->
      <div class="empty-state" *ngIf="project.missingStats && project.missingStats.withoutPhoto > 0 && data.students.length === 0 && data.teachers.length === 0">
        <div class="empty-state__icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
          </svg>
        </div>
        <h2 class="empty-state__title">Nincs tal√°lat</h2>
        <p class="empty-state__text">Pr√≥b√°lj m√°s keres√©si kifejez√©st</p>
      </div>
    </ng-container>
  </main>
</div>
