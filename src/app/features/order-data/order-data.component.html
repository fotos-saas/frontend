<div class="order-data page-card">
  <!-- Header -->
  <header id="main-content" class="order-data__header" tabindex="-1">
    <h1 class="order-data__title">Megrendel√©si adatok</h1>
    <p class="order-data__subtitle">A leadott rendel√©sb≈ël √∂sszegy≈±jt√∂tt inform√°ci√≥k</p>
    @if (orderData()?.orderDate) {
      <p class="order-data__date-header">
        Leadva: {{ orderData()?.orderDate | date:'yyyy. MM. dd.' }}
      </p>
    }
  </header>

  <!-- Loading -->
  @if (loading) {
    <div
      class="order-data__loading"
      role="status"
      aria-live="polite"
      aria-label="Megrendel√©si adatok bet√∂lt√©se folyamatban">
      <div class="order-data__spinner" aria-hidden="true"></div>
      <p>Adatok bet√∂lt√©se...</p>
      <span class="sr-only">K√©rem v√°rjon, a megrendel√©si adatok bet√∂lt√©se folyamatban van</span>
    </div>
  }

  <!-- Error -->
  @if (error && !loading) {
    <div
      class="order-data__error"
      role="alert"
      aria-live="assertive"
      aria-atomic="true">
      <p>{{ error }}</p>
      <button class="order-data__retry-btn" (click)="loadOrderData()">
        √öjrapr√≥b√°lkoz√°s
      </button>
    </div>
  }

  <!-- Empty state -->
  @if (!loading && !error && !orderData()) {
    <div
      class="order-data__empty"
      role="status"
      aria-label="M√©g nincs leadott megrendel√©s">
      <div class="order-data__empty-icon" aria-hidden="true">üìã</div>
      <p>M√©g nincs leadott megrendel√©s</p>
    </div>
  }

  <!-- Content -->
  @if (!loading && !error && orderData()) {
    <div class="order-data__content">

      <!-- Top row: Kapcsolattart√≥ + Iskola √©s oszt√°ly -->
      <div class="order-data__row order-data__row--two-cols">
        <!-- Kapcsolattart√≥ -->
        @if (orderData()?.contactName || orderData()?.contactPhone || orderData()?.contactEmail) {
          <section class="order-data__section">
            <h2 class="order-data__section-title">Kapcsolattart√≥</h2>
            <div class="order-data__list">
              @if (orderData()?.contactName) {
                <div class="order-data__item">
                  <span class="order-data__label">N√©v</span>
                  <span class="order-data__value">{{ orderData()?.contactName }}</span>
                </div>
              }
              @if (orderData()?.contactPhone) {
                <div class="order-data__item">
                  <span class="order-data__label">Telefon</span>
                  <span class="order-data__value">{{ orderData()?.contactPhone }}</span>
                </div>
              }
              @if (orderData()?.contactEmail) {
                <div class="order-data__item">
                  <span class="order-data__label">Email</span>
                  <span class="order-data__value">{{ orderData()?.contactEmail }}</span>
                </div>
              }
            </div>
          </section>
        }

        <!-- Iskola √©s oszt√°ly -->
        <section class="order-data__section">
          <h2 class="order-data__section-title">Iskola √©s oszt√°ly</h2>
          <div class="order-data__list">
            @if (orderData()?.schoolName) {
              <div class="order-data__item">
                <span class="order-data__label">Iskola</span>
                <span class="order-data__value">{{ orderData()?.schoolName }}</span>
              </div>
            }
            @if (orderData()?.className || orderData()?.classYear) {
              <div class="order-data__item">
                <span class="order-data__label">Oszt√°ly</span>
                <span class="order-data__value">{{ orderData()?.className }} @if (orderData()?.classYear) {<span>({{ orderData()?.classYear }})</span>}</span>
              </div>
            }
            @if (orderData()?.studentCount || orderData()?.teacherCount) {
              <div class="order-data__item">
                <span class="order-data__label">L√©tsz√°m</span>
                <span class="order-data__value">
                  @if (orderData()?.studentCount) {<span>{{ orderData()?.studentCount }} di√°k</span>}
                  @if (orderData()?.studentCount && orderData()?.teacherCount) {<span>, </span>}
                  @if (orderData()?.teacherCount) {<span>{{ orderData()?.teacherCount }} tan√°r</span>}
                </span>
              </div>
            }
          </div>
        </section>
      </div>

      <!-- Tabl√≥ be√°ll√≠t√°sok -->
      @if (orderData()?.color || orderData()?.fontFamily || orderData()?.sortType) {
        <section class="order-data__section">
          <h2 class="order-data__section-title">Tabl√≥ be√°ll√≠t√°sok</h2>
          <div class="order-data__grid order-data__grid--three">
            @if (orderData()?.color) {
              <div class="order-data__item">
                <span class="order-data__label">Sz√≠n</span>
                <span class="order-data__value order-data__value--color">
                  <span class="order-data__color-swatch" [style.background-color]="orderData()?.color"></span>
                  {{ orderData()?.color }}
                </span>
              </div>
            }
            @if (orderData()?.fontFamily) {
              <div class="order-data__item">
                <span class="order-data__label">Bet≈±t√≠pus</span>
                <span class="order-data__value">{{ orderData()?.fontFamily }}</span>
              </div>
            }
            @if (orderData()?.sortType) {
              <div class="order-data__item">
                <span class="order-data__label">Rendez√©s</span>
                <span class="order-data__value">{{ orderData()?.sortType }}</span>
              </div>
            }
          </div>
        </section>
      }

      <!-- Le√≠r√°s -->
      @if (orderData()?.description) {
        <section class="order-data__section">
          <h2 class="order-data__section-title">Le√≠r√°s / Megjegyz√©sek</h2>
          <div class="order-data__description" [innerHTML]="orderData()?.description | safeHtml"></div>
        </section>
      }

      <!-- Id√©zet -->
      @if (orderData()?.quote) {
        <section class="order-data__section">
          <h2 class="order-data__section-title">Id√©zet</h2>
          <blockquote class="order-data__quote">{{ orderData()?.quote }}</blockquote>
        </section>
      }

      <!-- N√©vsorok - 2 oszlopban -->
      @if (orderData()?.studentDescription || orderData()?.teacherDescription) {
        <div class="order-data__row order-data__row--two-cols">
          <!-- Di√°kok n√©vsora -->
          @if (orderData()?.studentDescription) {
            <section class="order-data__section">
              <h2 class="order-data__section-title">Di√°kok n√©vsora</h2>
              <div class="order-data__namelist" [innerHTML]="orderData()?.studentDescription | linkify"></div>
            </section>
          }

          <!-- Tan√°rok n√©vsora -->
          @if (orderData()?.teacherDescription) {
            <section class="order-data__section">
              <h2 class="order-data__section-title">Tan√°rok n√©vsora</h2>
              <div class="order-data__namelist" [innerHTML]="orderData()?.teacherDescription | linkify"></div>
            </section>
          }
        </div>
      }

      <!-- Jellemz≈ëk (tags) -->
      @if (hasTags()) {
        <section class="order-data__section">
          <h2 class="order-data__section-title">Jellemz≈ëk</h2>
          <div class="order-data__tags">
            @for (tag of orderData()?.tags; track tag) {
              <span class="order-data__tag">
                {{ tag }}
              </span>
            }
          </div>
        </section>
      }

      <!-- AI √∂sszefoglal√≥ -->
      @if (orderData()?.aiSummary) {
        <section class="order-data__section">
          <h2 class="order-data__section-title">AI √∂sszefoglal√≥</h2>
          <p class="order-data__summary">{{ orderData()?.aiSummary }}</p>
        </section>
      }

      <!-- Footer: PDF gomb + d√°tum -->
      <footer class="order-data__footer">
        @if (hasPdf()) {
          <button
            class="order-data__pdf-btn"
            (click)="openPdf()"
            [disabled]="generatingPdf"
            [class.order-data__pdf-btn--loading]="generatingPdf">
            @if (!generatingPdf) {
              <span>üìÑ Megrendel≈ëlap megtekint√©se</span>
            }
            @if (generatingPdf) {
              <span>‚è≥ PDF gener√°l√°sa...</span>
            }
          </button>
        }
        @if (orderData()?.orderDate) {
          <p class="order-data__date">
            Megrendel√©s leadva: {{ orderData()?.orderDate | date:'yyyy. MM. dd.' }}
          </p>
        }
      </footer>
    </div>
  }
</div>
