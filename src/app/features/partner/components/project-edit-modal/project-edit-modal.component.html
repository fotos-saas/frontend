<app-dialog-wrapper
  variant="edit"
  headerStyle="hero"
  theme="blue"
  [icon]="ICONS.EDIT"
  title="Projekt szerkesztése"
  description="Módosítsd a projekt adatait"
  size="md"
  [closable]="!submitting()"
  [errorMessage]="error()"
  (closeEvent)="close.emit()"
  (submitEvent)="onSubmit()"
>
  <ng-container dialogBody>
    <!-- Iskola kiválasztás -->
    <div class="autocomplete-section">
      <label class="ps-field__label">Iskola</label>
      <div class="school-input-wrapper">
        <div class="school-search">
          <lucide-icon [name]="ICONS.SEARCH" [size]="16" class="search-icon" />
          <input
            type="text"
            placeholder="Keress iskola név vagy város alapján..."
            [(ngModel)]="schoolSearch"
            name="schoolSearch"
            (input)="onSchoolSearch()"
            (focus)="onSchoolFocus()"
            (blur)="onSchoolBlur($event)"
            class="ps-field__input school-search-input"
            autocomplete="off"
          />
          @if (selectedSchool) {
            <button type="button" class="clear-school-btn" (click)="clearSchool()">
              <lucide-icon [name]="ICONS.X" [size]="14" />
            </button>
          }
        </div>

        <!-- Iskola dropdown -->
        @if (showSchoolDropdown && schoolsLoading()) {
          <div class="school-dropdown">
            <div class="dropdown-loading">
              <span class="dropdown-spinner"></span>
              Betöltés...
            </div>
          </div>
        } @else if (showSchoolDropdown && schools().length > 0) {
          <div class="school-dropdown">
            @for (school of schools(); track school.id) {
              <button
                type="button"
                class="school-option"
                [class.school-option--selected]="selectedSchool?.id === school.id"
                (mousedown)="selectSchool(school); $event.preventDefault()"
              >
                <span class="school-name">{{ school.name }}</span>
                @if (school.city) {
                  <span class="school-city">{{ school.city }}</span>
                }
              </button>
            }
          </div>
        }
      </div>
    </div>

    <!-- Osztály és Évfolyam -->
    <div class="form-row">
      <ps-input
        label="Osztály neve"
        placeholder="pl. 12.A"
        [(ngModel)]="formData.class_name"
        name="className"
      />
      <ps-input
        label="Évfolyam"
        placeholder="pl. 2024"
        [(ngModel)]="formData.class_year"
        name="classYear"
      />
    </div>

    <!-- Dátumok -->
    <div class="form-row">
      <ps-datepicker
        label="Fotózás dátuma"
        [(ngModel)]="formData.photo_date"
        name="photoDate"
      />
      <ps-datepicker
        label="Határidő"
        [(ngModel)]="formData.deadline"
        name="deadline"
      />
    </div>
  </ng-container>

  <ng-container dialogFooter>
    <button type="button" class="btn btn--outline" (click)="close.emit()" [disabled]="submitting()">
      Mégse
    </button>
    <button type="button" class="btn btn--primary" [disabled]="submitting()" (click)="onSubmit()">
      @if (submitting()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="16" class="spin" />
        Mentés...
      } @else {
        <lucide-icon [name]="ICONS.CHECK" [size]="18" />
        Mentés
      }
    </button>
  </ng-container>
</app-dialog-wrapper>
