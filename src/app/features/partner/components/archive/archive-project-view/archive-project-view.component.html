<!-- Szűrők -->
<div class="project-filters">
  <ps-searchable-select
    class="filter-select"
    [options]="schoolOptions()"
    [value]="selectedSchoolId()"
    placeholder="Iskola keresése..."
    allLabel="Minden iskola"
    (valueChange)="onSchoolChange($event)"
  />

  <ps-searchable-select
    class="filter-select filter-select--sm"
    [options]="classYears()"
    [value]="selectedYear()"
    placeholder="Évfolyam..."
    allLabel="Minden évfolyam"
    (valueChange)="onYearChange($event)"
  />

  <button
    class="filter-toggle"
    [class.filter-toggle--active]="missingOnly()"
    (click)="onMissingOnlyChange()"
  >
    <lucide-icon [name]="ICONS.CAMERA" [size]="14" />
    Csak hiányzó
  </button>
</div>

<!-- Summary -->
@if (!loading() && schoolGroups().length > 0) {
  <div class="summary-bar">
    <div class="summary-item">
      <lucide-icon [name]="ICONS.SCHOOL" [size]="16" />
      <span>{{ summary().totalSchools }} iskola</span>
    </div>
    <div class="summary-item">
      <lucide-icon [name]="config().icon" [size]="16" />
      <span>{{ summary().totalItems }} {{ config().entityLabel }}</span>
    </div>
    <div class="summary-item summary-item--ok">
      <lucide-icon [name]="ICONS.CHECK_CIRCLE" [size]="16" />
      <span>{{ summary().withPhoto }} fotóval</span>
    </div>
    @if (summary().missingPhoto > 0) {
      <div class="summary-item summary-item--warn">
        <lucide-icon [name]="ICONS.ALERT_TRIANGLE" [size]="16" />
        <span>{{ summary().missingPhoto }} hiányzó</span>
      </div>
    }

    <div class="summary-actions">
      @if (summary().withPhoto > 0) {
        <button
          class="download-btn"
          (click)="downloadAllRequest.emit()"
          [disabled]="downloading()"
        >
          <lucide-icon [name]="ICONS.DOWNLOAD" [size]="14" />
          {{ downloading() ? 'Letöltés...' : 'Letöltöm mind (' + summary().withPhoto + ')' }}
        </button>
      }
      <button class="expand-btn" (click)="expandAll()">
        <lucide-icon [name]="ICONS.CHEVRON_DOWN" [size]="14" />
        Mind
      </button>
      <button class="expand-btn" (click)="collapseAll()">
        <lucide-icon [name]="ICONS.CHEVRON_UP" [size]="14" />
        Bezár
      </button>
    </div>
  </div>
}

<!-- Tartalom -->
@if (loading()) {
  <div class="loading-state">
    @for (i of [1, 2, 3, 4]; track i) {
      <div class="skeleton-card skeleton-shimmer"></div>
    }
  </div>
} @else if (totalSchoolCount() === 0) {
  <div class="empty-state">
    <lucide-icon [name]="ICONS.SCHOOL" [size]="40" />
    <p>
      @if (missingOnly()) {
        Nincs hiányzó fotó a szűrt iskolákban.
      } @else {
        Nincs iskola a szűrési feltételeknek megfelelően.
      }
    </p>
  </div>
} @else {
  <div class="school-list">
    @for (school of paginatedSchoolGroups(); track school.schoolId; let i = $index) {
      <app-archive-project-card
        [school]="school"
        [config]="config()"
        [expanded]="isExpanded(school.schoolId)"
        [isSyncing]="syncingSchoolId() === school.schoolId"
        [isDownloading]="downloadingSchoolId() === school.schoolId"
        (toggle)="toggleSchool(school.schoolId)"
        (syncPhotos)="onSyncPhotos(school)"
        (syncSingleItem)="onSyncSingleItem($event)"
        (uploadPhoto)="onUploadPhoto($event, school.schoolId)"
        (viewPhoto)="onViewPhoto($event)"
        (markNoPhoto)="onMarkNoPhoto($event)"
        (undoNoPhoto)="onUndoNoPhoto($event)"
        (downloadSchool)="onDownloadSchool(school)"
        [style.animation-delay]="i * 0.03 + 's'"
      />
    }
  </div>

  @if (totalPages() > 1) {
    <app-list-pagination
      [currentPage]="currentPage()"
      [totalPages]="totalPages()"
      [totalItems]="totalSchoolCount()"
      itemLabel="iskola"
      (pageChange)="setPage($event)"
    />
  }
}
