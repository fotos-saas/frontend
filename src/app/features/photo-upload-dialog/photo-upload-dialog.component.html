<!-- Title bar (drag handle) -->
<div class="title-bar">
  <div class="drag-handle">
    <lucide-icon [name]="ICONS.CAMERA" [size]="16" />
    <span>Foto feltoltes</span>
  </div>
  <button class="close-btn" (click)="close()" type="button">
    <lucide-icon [name]="ICONS.X" [size]="16" />
  </button>
</div>

<div class="content">
  <!-- Kereses -->
  <div class="search-box">
    <lucide-icon [name]="ICONS.SEARCH" [size]="16" class="search-icon" />
    <input
      type="text"
      placeholder="Szemely keresese..."
      [value]="searchQuery()"
      (input)="onSearchInput($event)"
      class="search-input"
    />
  </div>

  <!-- Szemely lista -->
  <div class="person-list">
    @if (loading()) {
      <div class="loading-state">Betoltes...</div>
    } @else if (filteredPersons().length === 0) {
      <div class="empty-state">
        @if (searchQuery()) {
          Nincs talalat: "{{ searchQuery() }}"
        } @else {
          Nincsenek szemelyek a projektben.
        }
      </div>
    } @else {
      @for (person of filteredPersons(); track person.id) {
        <button
          class="person-row"
          [class.selected]="selectedPerson()?.id === person.id"
          [class.has-photo]="person.hasPhoto"
          (click)="selectPerson(person)"
          type="button"
        >
          <div class="person-avatar">
            @if (person.photoThumbUrl) {
              <img [src]="person.photoThumbUrl" [alt]="person.name" />
            } @else {
              <lucide-icon [name]="ICONS.USER" [size]="18" />
            }
          </div>
          <div class="person-info">
            <span class="person-name">{{ person.name }}</span>
            <span class="person-type">{{ person.type === 'teacher' ? 'Tanar' : 'Diak' }}</span>
          </div>
          @if (person.hasPhoto) {
            <lucide-icon [name]="ICONS.CHECK" [size]="14" class="photo-check" />
          }
        </button>
      }
    }
  </div>

  <!-- Feltoltes zona -->
  @if (selectedPerson()) {
    <div class="upload-section">
      <div class="selected-label">
        <lucide-icon [name]="ICONS.USER" [size]="14" />
        <span>{{ selectedPerson()!.name }}</span>
      </div>

      <!-- Drag & Drop zona -->
      <div
        class="drop-zone"
        [class.drag-over]="dragOver()"
        [class.has-file]="!!selectedFile()"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
      >
        @if (selectedFile()) {
          <lucide-icon [name]="ICONS.IMAGE" [size]="24" class="file-icon" />
          <span class="file-name">{{ selectedFile()!.name }}</span>
          <span class="file-size">{{ (selectedFile()!.size / 1024 / 1024).toFixed(1) }} MB</span>
        } @else {
          <lucide-icon [name]="ICONS.UPLOAD" [size]="24" />
          <span>Huzd ide a kepet vagy</span>
          <label class="file-label">
            valassz fajlt
            <input type="file" accept="image/*" (change)="onFileSelect($event)" hidden />
          </label>
        }
      </div>

      <!-- Feltoltes gomb -->
      <button
        class="upload-btn"
        [disabled]="!canUpload()"
        (click)="upload()"
        type="button"
      >
        @if (uploading()) {
          <span class="spinner"></span>
          Feltoltes...
        } @else {
          <lucide-icon [name]="ICONS.UPLOAD" [size]="16" />
          Feltoltes
        }
      </button>

      <!-- Eredmeny -->
      @if (uploadResult()) {
        <div class="result" [class.success]="uploadResult()!.success" [class.error]="!uploadResult()!.success">
          @if (uploadResult()!.success) {
            <lucide-icon [name]="ICONS.CHECK_CIRCLE" [size]="16" />
            <span>Sikeres feltoltes!</span>
            @if (uploadResult()!.photo?.thumbUrl) {
              <img [src]="uploadResult()!.photo!.thumbUrl" alt="Feltoltott kep" class="result-thumb" />
            }
          } @else {
            <lucide-icon [name]="ICONS.ALERT_CIRCLE" [size]="16" />
            <span>{{ uploadResult()!.message }}</span>
          }
        </div>
      }
    </div>
  }
</div>
