<div class="dialog-backdrop"
     (mousedown)="backdropHandler.onMouseDown($event)"
     (click)="backdropHandler.onClick($event)">
  <div class="dialog-panel dialog-panel--lg p-5" (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-gray-900">
        {{ editVersion() ? 'Verzió szerkesztése' : 'Új verzió' }}
      </h3>
      <button class="close-btn" (click)="close.emit()">
        <lucide-icon [name]="ICONS.X" [size]="18" />
      </button>
    </div>

    <div class="form-fields">
      <!-- Kép feltöltés -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Minta kép</label>
        @if (previewUrl) {
          <div class="preview-container">
            <img [src]="previewUrl" alt="Előnézet" class="preview-image" />
            <button class="preview-remove" (click)="removeImage()">
              <lucide-icon [name]="ICONS.X" [size]="14" />
            </button>
          </div>
        } @else {
          <div
            class="drop-zone"
            [class.drop-zone--active]="isDragging()"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave()"
            (drop)="onDrop($event)"
            (click)="fileInput.click()"
          >
            <lucide-icon [name]="ICONS.UPLOAD" [size]="32" class="drop-icon" />
            <p class="drop-text">Húzd ide a képet vagy kattints a tallózáshoz</p>
            <p class="drop-hint">JPEG, PNG, WebP - max 10 MB</p>
          </div>
        }
        <input
          #fileInput
          type="file"
          accept="image/jpeg,image/png,image/webp"
          class="hidden"
          (change)="onFileSelected($event)"
        />
      </div>

      <!-- Leírás -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Leírás</label>
        <textarea
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-y"
          rows="3"
          [(ngModel)]="description"
          placeholder="Verzió leírása..."
          maxlength="2000"
        ></textarea>
        <span class="text-xs text-gray-400 mt-1 block">{{ description.length }} / 2000</span>
      </div>
    </div>

    <div class="flex justify-end mt-5" style="margin: -4px; margin-top: 20px;">
      <button
        class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg text-sm transition-colors"
        style="margin: 4px;"
        (click)="close.emit()"
      >Mégse</button>
      <button
        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white font-medium rounded-lg text-sm transition-colors"
        style="margin: 4px;"
        [disabled]="saving() || !isValid"
        (click)="save()"
      >{{ saving() ? 'Mentés...' : 'Mentés' }}</button>
    </div>
  </div>
</div>
