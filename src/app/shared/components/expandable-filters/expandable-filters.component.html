<div class="expandable-filters">
  <!-- Látható szűrők (első N db) - inline -->
  @for (filter of visibleFilters(); track filter.id) {
    <ps-select
      class="filter-item"
      size="sm"
      [emptyLabel]="filter.label"
      [options]="toPsOptions(filter)"
      [ngModel]="getFilterValue(filter.id)"
      (ngModelChange)="onPsSelectChange(filter.id, $event)"
    />
  }

  <!-- "További szűrők" gomb + dropdown (ha van rejtett) -->
  @if (hasHiddenFilters()) {
    <div class="more-filters-wrapper">
      <button
        type="button"
        class="more-filters-btn"
        [class.more-filters-btn--active]="expanded() || activeHiddenCount() > 0"
        (click)="toggleExpanded($event)"
      >
        <lucide-icon [name]="ICONS.FILTER" [size]="14" />
        <span class="more-filters-btn__text">További</span>
        @if (activeHiddenCount() > 0) {
          <span class="active-dot"></span>
        }
        <lucide-icon
          [name]="expanded() ? ICONS.CHEVRON_UP : ICONS.CHEVRON_DOWN"
          [size]="12"
          class="more-filters-btn__chevron"
        />
      </button>

      <!-- Dropdown panel - gomb alatt jelenik meg -->
      @if (expanded()) {
        <div class="filters-dropdown" (click)="$event.stopPropagation()">
          @for (filter of hiddenFilters(); track filter.id) {
            <div class="dropdown-filter">
              <ps-select
                [label]="filter.label"
                size="sm"
                emptyLabel="Mind"
                [options]="toPsOptions(filter)"
                [ngModel]="getFilterValue(filter.id)"
                (ngModelChange)="onPsSelectChange(filter.id, $event)"
              />
            </div>
          }

          <!-- Szűrők törlése gomb -->
          @if (activeHiddenCount() > 0) {
            <button
              type="button"
              class="clear-filters-btn"
              (click)="clearHiddenFilters()"
            >
              <lucide-icon [name]="ICONS.X" [size]="12" />
              Szűrők törlése
            </button>
          }
        </div>
      }
    </div>
  }

  <!-- Összes szűrő törlése gomb (ha van bármelyik aktív) -->
  @if (hasAnyActiveFilter()) {
    <button
      type="button"
      class="clear-all-btn"
      (click)="clearAllFilters($event)"
      matTooltip="Szűrők törlése"
    >
      <lucide-icon [name]="ICONS.X" [size]="14" />
    </button>
  }
</div>
