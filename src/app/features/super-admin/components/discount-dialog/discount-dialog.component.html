<div class="dialog-backdrop" (mousedown)="backdropHandler.onMouseDown($event)" (click)="backdropHandler.onClick($event)">
  <div #dialogContent class="dialog dialog--md" (click)="$event.stopPropagation()" role="dialog" aria-modal="true" tabindex="-1">
    <!-- Header -->
    <header class="dialog__header">
      <div class="dialog__icon dialog__icon--discount">
        <lucide-icon [name]="ICONS.PERCENT" [size]="28" />
      </div>
      <h2 class="dialog__title">{{ currentDiscount() ? 'Kedvezmény módosítása' : 'Kedvezmény beállítása' }}</h2>
      <p class="dialog__subtitle">{{ subscriberName() }}</p>
    </header>

    <!-- Content -->
    <div class="dialog__content">
      <form (ngSubmit)="onSubmit()">
        <!-- Százalék -->
        <div class="form-group">
          <ps-input
            type="number"
            label="Kedvezmény mértéke (%)"
            [ngModel]="percent()"
            (ngModelChange)="percent.set($event)"
            [min]="1"
            [max]="99"
            [required]="true"
            placeholder="pl. 20"
          />
          @if (percent() > 0 && percent() <= 99) {
            <span class="form-hint">{{ percent() }}% kedvezmény minden számlából</span>
          }
        </div>

        <!-- Időtartam típus -->
        <div class="form-group">
          <ps-radio-group
            label="Érvényesség"
            [options]="durationOptions"
            [ngModel]="durationType()"
            (ngModelChange)="durationType.set($event)"
            direction="horizontal"
          />
        </div>

        <!-- Hónapok száma -->
        @if (durationType() === 'months') {
          <div class="form-group">
            <ps-input
              type="number"
              label="Hónapok száma"
              [ngModel]="durationMonths()"
              (ngModelChange)="durationMonths.set($event)"
              [min]="1"
              [max]="120"
              [required]="true"
              placeholder="pl. 6"
            />
            @if (durationMonths() > 0) {
              <span class="form-hint">{{ formatExpiryDate() }}-ig érvényes</span>
            }
          </div>
        }

        <!-- Megjegyzés -->
        <div class="form-group">
          <ps-textarea
            label="Megjegyzés (opcionális)"
            [ngModel]="note()"
            (ngModelChange)="note.set($event)"
            [maxLength]="500"
            [rows]="3"
            placeholder="pl. Hűségkedvezmény, egyedi megállapodás..."
          />
        </div>

        @if (currentDiscount()) {
          <div class="info-box">
            <lucide-icon [name]="ICONS.INFO" [size]="16" />
            <span>A jelenlegi {{ currentDiscount() }}% kedvezmény felülírásra kerül.</span>
          </div>
        }

        @if (errorMessage()) {
          <div class="error-message">
            <lucide-icon [name]="ICONS.ALERT_CIRCLE" [size]="16" />
            {{ errorMessage() }}
          </div>
        }
      </form>
    </div>

    <!-- Footer -->
    <footer class="dialog__footer">
      <button
        type="button"
        class="btn btn--secondary"
        (click)="onCancel()"
        [disabled]="isSubmitting()"
      >
        Mégse
      </button>
      <button
        type="button"
        class="btn btn--primary"
        (click)="onSubmit()"
        [disabled]="isSubmitting() || !isFormValid()"
      >
        @if (isSubmitting()) {
          <span class="btn__spinner"></span>
        }
        Mentés
      </button>
    </footer>
  </div>
</div>
