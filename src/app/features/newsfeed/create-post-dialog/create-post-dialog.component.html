<app-hero-dialog-wrapper
  theme="green"
  [icon]="dialogIcon()"
  [title]="dialogTitle()"
  [description]="dialogDescription()"
  size="xl"
  [isSubmitting]="isSubmitting()"
  [errorMessage]="errorMessage()"
  (closeEvent)="onClose()"
>
  <ng-container dialogBody>
    <!-- Type selector (disabled in edit mode) -->
    <div class="field">
      <label class="field__label">Típus</label>
      <div class="type-selector">
        <button
          type="button"
          class="type-btn"
          [class.type-btn--active]="postType === 'announcement'"
          (click)="onTypeChange('announcement')"
          [disabled]="isSubmitting() || isEditMode()"
        >
          <lucide-icon [name]="ICONS.ACTIVITY" [size]="18" />
          Bejelentés
        </button>
        <button
          type="button"
          class="type-btn"
          [class.type-btn--active]="postType === 'event'"
          (click)="onTypeChange('event')"
          [disabled]="isSubmitting() || isEditMode()"
        >
          <lucide-icon [name]="ICONS.CALENDAR" [size]="18" />
          Esemény
        </button>
      </div>
      @if (isEditMode()) {
        <span class="field__hint">A típus nem módosítható szerkesztéskor.</span>
      }
    </div>

    <!-- Title field -->
    <div class="field">
      <label class="field__label" for="post-title">
        Cím <span class="field__required">*</span>
      </label>
      <input
        #titleInput
        type="text"
        id="post-title"
        class="field__input"
        [class.field__input--error]="errors.title"
        [(ngModel)]="title"
        (ngModelChange)="onInputChange()"
        [placeholder]="postType === 'event' ? 'Pl.: Osztálykirándulás' : 'Pl.: Fontos bejelentés'"
        [disabled]="isSubmitting()"
        maxlength="255"
        autocomplete="off"
      />
      <div class="field__footer">
        @if (errors.title) {
          <span class="field__error">{{ errors.title }}</span>
        } @else {
          <span class="field__char-count">{{ titleCharCount }}</span>
        }
      </div>
    </div>

    <!-- Event details (only for events) -->
    @if (postType === 'event') {
    <div class="event-details">
      <!-- Event date -->
      <div class="field field--half">
        <label class="field__label" for="event-date">
          Dátum <span class="field__required">*</span>
        </label>
        <input
          type="date"
          id="event-date"
          class="field__input"
          [class.field__input--error]="errors.eventDate"
          [(ngModel)]="eventDate"
          (ngModelChange)="onInputChange()"
          [min]="minDate"
          [disabled]="isSubmitting()"
        />
        @if (errors.eventDate) {
          <span class="field__error">{{ errors.eventDate }}</span>
        }
      </div>

      <!-- Event time -->
      <div class="field field--half">
        <label class="field__label" for="event-time">
          Időpont <span class="field__optional">(opcionális)</span>
        </label>
        <input
          type="time"
          id="event-time"
          class="field__input"
          [(ngModel)]="eventTime"
          (ngModelChange)="onInputChange()"
          [disabled]="isSubmitting()"
        />
      </div>

      <!-- Event location -->
      <div class="field">
        <label class="field__label" for="event-location">
          Helyszín <span class="field__optional">(opcionális)</span>
        </label>
        <input
          type="text"
          id="event-location"
          class="field__input"
          [(ngModel)]="eventLocation"
          (ngModelChange)="onInputChange()"
          placeholder="Pl.: Eger, Dobó tér"
          [disabled]="isSubmitting()"
          maxlength="255"
        />
      </div>
    </div>
    }

    <!-- Content field -->
    <div class="field">
      <label class="field__label" for="post-content">
        Tartalom <span class="field__optional">(opcionális)</span>
      </label>
      <app-rich-text-editor
        [(ngModel)]="content"
        name="richContent"
        mode="standard"
        placeholder="Írd le a részleteket..."
        [disabled]="isSubmitting()"
        [minHeight]="120"
        [maxHeight]="200"
        (textLengthChangeEvent)="onContentTextLengthChange($event)"
      />
      <div class="field__footer">
        @if (errors.content) {
          <span class="field__error">{{ errors.content }}</span>
        } @else {
          <span class="field__char-count">{{ contentTextLength }}/5000</span>
        }
      </div>
    </div>

    <!-- Media Editor Component -->
    <div class="field">
      <app-media-editor
        [existingMedia]="existingMediaItems()"
        [maxFiles]="validator.maxFiles"
        [maxSizeMB]="10"
        [disabled]="isSubmitting()"
        [existingLabel]="'Meglévő képek/videók'"
        [newLabel]="isEditMode() ? 'Új képek/videók hozzáadása' : 'Képek/Videók'"
        (newFilesChange)="onNewFilesChange($event)"
        (mediaToDeleteChange)="onMediaToDeleteChange($event)"
        (error)="onMediaError($event)"
      />
      @if (errors.media) {
        <span class="field__error">{{ errors.media }}</span>
      }
    </div>

    <!-- Actions -->
    <div class="actions">
      <button
        type="button"
        class="btn btn--secondary"
        (click)="onClose()"
        [disabled]="isSubmitting()"
      >
        Mégse
      </button>

      <button
        type="button"
        class="btn btn--primary"
        (click)="submit()"
        [disabled]="!isFormValid || isSubmitting()"
      >
        @if (isSubmitting()) {
          <lucide-icon [name]="ICONS.LOADER" [size]="18" class="spin" />
        } @else if (!isEditMode()) {
          <lucide-icon [name]="ICONS.SEND" [size]="18" />
        } @else {
          <lucide-icon [name]="ICONS.SAVE" [size]="18" />
        }
        {{ submitButtonText() }}
      </button>
    </div>
  </ng-container>
</app-hero-dialog-wrapper>
