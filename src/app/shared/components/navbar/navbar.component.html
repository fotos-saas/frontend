<nav #navbarContainer class="navbar" role="navigation" aria-label="F≈ë navig√°ci√≥">
  <!-- Mobile Header - l√°that√≥ ha isMobileMode() true -->
  <div class="navbar__mobile-header" [class.navbar__mobile-header--visible]="isMobileMode()">
    <!-- Hamburger Button (Left) -->
    <button
      class="navbar__hamburger"
      [class.navbar__hamburger--open]="mobileMenuOpen()"
      (click)="toggleMobileMenu()"
      [attr.aria-expanded]="mobileMenuOpen()"
      aria-controls="mobile-navigation"
      [attr.aria-label]="mobileMenuOpen() ? 'Men√º bez√°r√°sa' : 'Men√º megnyit√°sa'"
      type="button"
    >
      <span class="navbar__hamburger-line" aria-hidden="true"></span>
      <span class="navbar__hamburger-line" aria-hidden="true"></span>
      <span class="navbar__hamburger-line" aria-hidden="true"></span>
    </button>

    <!-- Logo & Status (Center) -->
    <div class="navbar__mobile-brand">
      <a routerLink="/home" class="navbar__logo" aria-label="Tabl√≥kir√°ly - Kezd≈ëlap">Tabl√≥kir√°ly</a>
      <!-- Kapcsolattart√≥ neve (code token eset√©n - kattinthat√≥) -->
      @if (isCode() && contactDisplayName()) {
        <app-contact-badge
          [contactName]="contactDisplayName()"
          (editEvent)="openContactEditDialog()"
        />
      }
      <!-- Regisztr√°lt vend√©g neve (share token eset√©n - kattinthat√≥) -->
      @if (isGuest() && hasGuestSession()) {
        <app-user-badge
          [displayName]="displayName()"
          (editEvent)="openEditDialog()"
        />
      }
      <!-- Vend√©g badge (ha share token √âS nincs regisztr√°lt session) -->
      @if (isGuest() && !hasGuestSession()) {
        <app-guest-badge />
      }
      <!-- Admin el≈ën√©zet badge -->
      @if (isPreview()) {
        <span
          class="navbar__preview-badge"
          role="status"
          aria-label="Admin el≈ën√©zet m√≥dban b√∂ng√©szel"
        >
          Admin el≈ën√©zet
        </span>
      }
      @if (getStatusName()) {
        <span class="navbar__status" [ngClass]="getStatusBadgeClasses()">
          {{ getStatusName() }}
        </span>
      }
    </div>

    <!-- Notification Bell + Logout (Right - mobile only) -->
    <div class="navbar__mobile-actions">
      <!-- B√∂k√©s √©rtes√≠t√©sek (ha van guest session) -->
      @if (hasGuestSession()) {
        <a routerLink="/poke"
           class="navbar__poke-badge"
           (click)="closeMobileMenu()"
           aria-label="B√∂k√©sek"
           title="B√∂k√©sek">
          <span class="navbar__poke-badge-icon">üëâ</span>
          @if (pokeUnreadCount() > 0) {
            <span class="navbar__poke-badge-count">{{ pokeUnreadCount() > 99 ? '99+' : pokeUnreadCount() }}</span>
          }
        </a>
      }
      @if (hasGuestSession() || isCode()) {
        <app-notification-bell />
      }
      <button
        class="navbar__mobile-logout"
        (click)="logout()"
        [disabled]="loggingOut"
        aria-label="Kijelentkez√©s"
        type="button"
      >
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    </div>
  </div>

  <!-- Desktop Layout - l√°that√≥ ha isMobileMode() false -->
  <div #desktopContent class="navbar__desktop" [class.navbar__desktop--hidden]="isMobileMode()">
    <div class="navbar__left">
      <div class="navbar__brand">
        <div class="navbar__brand-row">
          <a routerLink="/home" class="navbar__logo" aria-label="Tabl√≥kir√°ly - Kezd≈ëlap">Tabl√≥kir√°ly</a>
          <!-- Kapcsolattart√≥ neve (code token eset√©n - kattinthat√≥) -->
          @if (isCode() && contactDisplayName()) {
            <app-contact-badge
              [contactName]="contactDisplayName()"
              (editEvent)="openContactEditDialog()"
            />
          }
          <!-- Regisztr√°lt vend√©g neve (share token eset√©n - kattinthat√≥) -->
          @if (isGuest() && hasGuestSession()) {
            <app-user-badge
              [displayName]="displayName()"
              (editEvent)="openEditDialog()"
            />
          }
          <!-- Vend√©g badge (ha share token √âS nincs regisztr√°lt session) -->
          @if (isGuest() && !hasGuestSession()) {
            <app-guest-badge />
          }
          <!-- Admin el≈ën√©zet badge -->
          @if (isPreview()) {
            <span
              class="navbar__preview-badge"
              role="status"
              aria-label="Admin el≈ën√©zet m√≥dban b√∂ng√©szel"
            >
              Admin el≈ën√©zet
            </span>
          }
        </div>
        @if (getStatusName()) {
          <span class="navbar__status" [ngClass]="getStatusBadgeClasses()">
            {{ getStatusName() }}
          </span>
        }
      </div>
      @if (projectInfo()?.schoolName) {
        <span class="navbar__project">
          {{ projectInfo()?.schoolName }}
          @if (projectInfo()?.className) {
            <span> ¬∑ {{ projectInfo()?.className }}</span>
          }
          @if (projectInfo()?.classYear) {
            <span> ({{ projectInfo()?.classYear }})</span>
          }
        </span>
      }
    </div>
    <div class="navbar__right">
      <div class="navbar__links">
        <a routerLink="/home"
           class="navbar__link"
           [class.navbar__link--active]="activePage() === 'home'"
           [attr.aria-current]="activePage() === 'home' ? 'page' : null">Kezd≈ëlap</a>
        @if (showSamples()) {
          <a routerLink="/samples"
             class="navbar__link"
             [class.navbar__link--active]="activePage() === 'samples'"
             [attr.aria-current]="activePage() === 'samples' ? 'page' : null">Mint√°k</a>
        }
        @if (showTemplateChooser()) {
          <a routerLink="/template-chooser"
             class="navbar__link"
             [class.navbar__link--active]="activePage() === 'template-chooser'"
             [attr.aria-current]="activePage() === 'template-chooser' ? 'page' : null">
            Minta V√°laszt√≥
          </a>
        }
        @if (showPersons()) {
          <a routerLink="/persons"
             class="navbar__link"
             [class.navbar__link--active]="activePage() === 'missing'"
             [attr.aria-current]="activePage() === 'missing' ? 'page' : null">Hi√°nyz√≥ k√©pek</a>
        }
        @if (showVoting()) {
          <a routerLink="/voting"
             class="navbar__link"
             [class.navbar__link--active]="activePage() === 'voting'"
             [attr.aria-current]="activePage() === 'voting' ? 'page' : null">Szavaz√°sok</a>
        }
        <a routerLink="/newsfeed"
           class="navbar__link"
           [class.navbar__link--active]="activePage() === 'newsfeed'"
           [attr.aria-current]="activePage() === 'newsfeed' ? 'page' : null">H√≠rfolyam</a>
        <a routerLink="/forum"
           class="navbar__link"
           [class.navbar__link--active]="activePage() === 'forum'"
           [attr.aria-current]="activePage() === 'forum' ? 'page' : null">Besz√©lget√©sek</a>
        @if (showOrderData()) {
          <a routerLink="/order-data"
             class="navbar__link"
             [class.navbar__link--active]="activePage() === 'order-data'"
             [attr.aria-current]="activePage() === 'order-data' ? 'page' : null">Megrendel√©s</a>
        }
        @if (showFinalization()) {
          <a routerLink="/order-finalization"
             class="navbar__link navbar__link--primary"
             [class.navbar__link--active]="activePage() === 'order-finalization'"
             [attr.aria-current]="activePage() === 'order-finalization' ? 'page' : null">V√©gleges√≠t√©s</a>
        }
      </div>
      <!-- B√∂k√©s √©rtes√≠t√©sek (ha van guest session) -->
      @if (hasGuestSession()) {
        <a routerLink="/poke"
           class="navbar__poke-badge"
           aria-label="B√∂k√©sek"
           title="B√∂k√©sek">
          <span class="navbar__poke-badge-icon">üëâ</span>
          @if (pokeUnreadCount() > 0) {
            <span class="navbar__poke-badge-count">{{ pokeUnreadCount() > 99 ? '99+' : pokeUnreadCount() }}</span>
          }
        </a>
      }
      <!-- √ârtes√≠t√©sek cseng≈ë (ha bejelentkezett guest vagy code token) -->
      @if (hasGuestSession() || isCode()) {
        <app-notification-bell />
      }
      <button
        class="navbar__logout"
        (click)="logout()"
        [disabled]="loggingOut"
        aria-label="Kijelentkez√©s"
        title="Kijelentkez√©s"
        type="button"
      >
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="navbar__logout-text">Kil√©p√©s</span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Overlay (Backdrop) - csak mobile m√≥dban m≈±k√∂dik -->
  <div
    class="navbar__overlay"
    [class.navbar__overlay--visible]="mobileMenuOpen()"
    [class.navbar__overlay--enabled]="isMobileMode()"
    (click)="closeMobileMenu()"
    aria-hidden="true"
    role="presentation"
  ></div>

  <!-- Mobile Menu Drawer - csak mobile m√≥dban el√©rhet≈ë -->
  <nav
    #mobileMenu
    id="mobile-navigation"
    class="navbar__mobile-menu"
    [class.navbar__mobile-menu--open]="mobileMenuOpen()"
    [class.navbar__mobile-menu--enabled]="isMobileMode()"
    [attr.aria-hidden]="!mobileMenuOpen()"
    aria-label="Mobil navig√°ci√≥"
  >
    <!-- Menu Header -->
    <div class="navbar__mobile-menu-header">
      <h2 class="navbar__mobile-menu-title">Men√º</h2>
      <button
        class="navbar__mobile-menu-close"
        (click)="closeMobileMenu()"
        aria-label="Men√º bez√°r√°sa"
        type="button"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- User Info (in mobile menu) - kapcsolattart√≥ (code token eset√©n) -->
    @if (isCode() && contactDisplayName()) {
      <app-mobile-menu-user
        [displayName]="contactDisplayName()"
        [mode]="'contact'"
        (editEvent)="openContactEditDialog()"
        (closeMenuEvent)="closeMobileMenu()"
      />
    }

    <!-- User Info (in mobile menu) - ha van guest session (share token) -->
    @if (isGuest() && hasGuestSession()) {
      <app-mobile-menu-user
        [displayName]="displayName()"
        [mode]="'guest'"
        (editEvent)="openEditDialog()"
        (closeMenuEvent)="closeMobileMenu()"
      />
    }

    <!-- Project Info (in mobile menu) -->
    @if (projectInfo()?.schoolName) {
      <div class="navbar__mobile-menu-project">
        <span class="navbar__mobile-menu-project-name">{{ projectInfo()?.schoolName }}</span>
        @if (projectInfo()?.className || projectInfo()?.classYear) {
          <span class="navbar__mobile-menu-project-details">
            {{ projectInfo()?.className }}
            @if (projectInfo()?.classYear) {
              <span>({{ projectInfo()?.classYear }})</span>
            }
          </span>
        }
      </div>
    }

    <!-- Navigation Links -->
    <ul class="navbar__mobile-menu-list">
      <li class="navbar__mobile-menu-item">
        <a
          routerLink="/home"
          class="navbar__mobile-menu-link"
          [class.navbar__mobile-menu-link--active]="activePage === 'home'"
          [attr.aria-current]="activePage === 'home' ? 'page' : null"
          (click)="closeMobileMenu()"
        >
          <svg class="navbar__mobile-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
          </svg>
          <span>Kezd≈ëlap</span>
        </a>
      </li>
      @if (showSamples()) {
        <li class="navbar__mobile-menu-item">
          <a
            routerLink="/samples"
            class="navbar__mobile-menu-link"
            [class.navbar__mobile-menu-link--active]="activePage === 'samples'"
            [attr.aria-current]="activePage === 'samples' ? 'page' : null"
            (click)="closeMobileMenu()"
          >
            <svg class="navbar__mobile-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
            </svg>
            <span>Mint√°k</span>
          </a>
        </li>
      }
      @if (showTemplateChooser()) {
        <li class="navbar__mobile-menu-item">
          <a
            routerLink="/template-chooser"
            class="navbar__mobile-menu-link"
            [class.navbar__mobile-menu-link--active]="activePage === 'template-chooser'"
            [attr.aria-current]="activePage === 'template-chooser' ? 'page' : null"
            (click)="closeMobileMenu()"
          >
            <svg class="navbar__mobile-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
            </svg>
            <span>Minta V√°laszt√≥</span>
          </a>
        </li>
      }
      @if (showPersons()) {
        <li class="navbar__mobile-menu-item">
          <a
            routerLink="/persons"
            class="navbar__mobile-menu-link"
            [class.navbar__mobile-menu-link--active]="activePage === 'missing'"
            [attr.aria-current]="activePage === 'missing' ? 'page' : null"
            (click)="closeMobileMenu()"
          >
            <svg class="navbar__mobile-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z" />
            </svg>
            <span>Hi√°nyz√≥ k√©pek</span>
          </a>
        </li>
      }
      @if (showVoting()) {
        <li class="navbar__mobile-menu-item">
          <a
            routerLink="/voting"
            class="navbar__mobile-menu-link"
            [class.navbar__mobile-menu-link--active]="activePage === 'voting'"
            [attr.aria-current]="activePage === 'voting' ? 'page' : null"
            (click)="closeMobileMenu()"
          >
            <svg class="navbar__mobile-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>Szavaz√°sok</span>
          </a>
        </li>
      }
      <li class="navbar__mobile-menu-item">
        <a
          routerLink="/newsfeed"
          class="navbar__mobile-menu-link"
          [class.navbar__mobile-menu-link--active]="activePage === 'newsfeed'"
          [attr.aria-current]="activePage === 'newsfeed' ? 'page' : null"
          (click)="closeMobileMenu()"
        >
          <svg class="navbar__mobile-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2" />
          </svg>
          <span>H√≠rfolyam</span>
        </a>
      </li>
      <li class="navbar__mobile-menu-item">
        <a
          routerLink="/forum"
          class="navbar__mobile-menu-link"
          [class.navbar__mobile-menu-link--active]="activePage === 'forum'"
          [attr.aria-current]="activePage === 'forum' ? 'page' : null"
          (click)="closeMobileMenu()"
        >
          <svg class="navbar__mobile-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z" />
          </svg>
          <span>Besz√©lget√©sek</span>
        </a>
      </li>
      @if (showOrderData()) {
        <li class="navbar__mobile-menu-item">
          <a
            routerLink="/order-data"
            class="navbar__mobile-menu-link"
            [class.navbar__mobile-menu-link--active]="activePage === 'order-data'"
            [attr.aria-current]="activePage === 'order-data' ? 'page' : null"
            (click)="closeMobileMenu()"
          >
            <svg class="navbar__mobile-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
            </svg>
            <span>Megrendel√©s</span>
          </a>
        </li>
      }
      @if (showFinalization()) {
        <li class="navbar__mobile-menu-item navbar__mobile-menu-item--primary">
          <a
            routerLink="/order-finalization"
            class="navbar__mobile-menu-link navbar__mobile-menu-link--primary"
            [class.navbar__mobile-menu-link--active]="activePage === 'order-finalization'"
            [attr.aria-current]="activePage === 'order-finalization' ? 'page' : null"
            (click)="closeMobileMenu()"
          >
            <svg class="navbar__mobile-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>V√©gleges√≠t√©s</span>
          </a>
        </li>
      }
    </ul>

    <!-- Logout Button (in mobile menu) -->
    <div class="navbar__mobile-menu-footer">
      <button
        class="navbar__mobile-menu-logout"
        (click)="logout()"
        [disabled]="loggingOut"
        type="button"
      >
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Kijelentkez√©s</span>
      </button>
    </div>
  </nav>
</nav>

<!-- Guest Name Edit Dialog (share token eset√©n) -->
@if (showEditDialog()) {
  <app-guest-name-dialog
    [mode]="'edit'"
    [initialName]="guestName() || ''"
    [initialEmail]="guestEmail() || ''"
    [canClose]="true"
    [isSubmitting]="isUpdating()"
    [errorMessage]="updateError()"
    (resultEvent)="onEditDialogResult($event)"
  />
}

<!-- Contact Edit Dialog (code token eset√©n) -->
@if (showContactEditDialog()) {
  <app-contact-edit-dialog
    [initialData]="contactEditData()"
    [isSaving]="isContactUpdating()"
    (resultEvent)="onContactEditResult($event)"
  />
}
