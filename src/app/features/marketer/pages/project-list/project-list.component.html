<div class="project-list-page page-card page-card--wide">
  <header class="page-header">
    <div class="header-content">
      <h1>Projektek</h1>
      <p class="subtitle">{{ totalProjects() }} projekt √∂sszesen</p>
    </div>
    <app-add-button
      [label]="'√öj projekt'"
      [variant]="'primary'"
      (clicked)="createProject()"
    />
  </header>

  <!-- Keres√©s + rendez√©s -->
  <app-smart-filter-bar
    [filterState]="filterState"
    [searchConfig]="{ placeholder: 'Keres√©s iskola vagy oszt√°ly neve alapj√°n...' }"
    [sortConfig]="marketerSortDef"
  />

  <!-- Lista -->
  @if (filterState.loading()) {
    <div class="loading-state">
      @for (i of [1, 2, 3, 4, 5]; track i) {
        <div class="project-row skeleton skeleton-shimmer"></div>
      }
    </div>
  } @else if (projects().length === 0) {
    <div class="empty-state">
      <span class="empty-icon">üì≠</span>
      <h3>Nincs tal√°lat</h3>
      <p>Pr√≥b√°lj m√°s keres√©si felt√©telekkel!</p>
    </div>
  } @else {
    <div [style.--table-cols]="gridTemplate">
    <app-table-header [columns]="tableCols" />

    <!-- Projekt sorok -->
    <div class="project-list">
      @for (project of projects(); track project.id; let i = $index) {
        <div
          class="project-row"
          [style.animation-delay]="i * 0.03 + 's'"
          (click)="viewProject(project)"
        >
          <div class="col-school">
            <span class="school-name">{{ project.schoolName ?? 'Ismeretlen iskola' }}</span>
            <span class="class-info">
              {{ project.className }} {{ project.classYear }}
            </span>
          </div>

          <div class="col-contact">
            @if (project.contact) {
              <span class="contact-name">{{ project.contact.name }}</span>
              <span class="contact-email">{{ project.contact.email }}</span>
            } @else {
              <span class="no-contact">-</span>
            }
          </div>

          <div class="col-actions" (click)="$event.stopPropagation()">
            <app-qr-button
              [isActive]="project.hasActiveQrCode"
              [variant]="'icon-only'"
              (clicked)="openQrModal(project)"
            />
          </div>
        </div>
      }
    </div>
    </div>

    <app-list-pagination
      [currentPage]="filterState.page()"
      [totalPages]="totalPages()"
      [totalItems]="totalProjects()"
      itemLabel="projekt"
      (pageChange)="filterState.setPage($event)"
    />
  }
</div>

<!-- QR Code Modal -->
@if (showQrModal()) {
  <app-shared-qr-code-modal
    [projectId]="selectedProjectId()!"
    [projectName]="selectedProjectName()"
    [qrService]="qrService"
    (close)="closeQrModal()"
    (qrCodeChanged)="onQrCodeChanged()"
  />
}
