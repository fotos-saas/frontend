<app-dialog-wrapper
  headerStyle="hero"
  theme="green"
  [icon]="ICONS.USERS"
  title="Jelenlévők"
  [description]="summaryText()"
  size="md"
  [closable]="true"
  (closeEvent)="closeEvent.emit()"
>
  <!-- Info alert az extra résztvevőkről -->
  @if (statistics() && statistics()!.extraCount > 0) {
    <div dialogBody class="info-alert">
      <lucide-icon [name]="ICONS.INFO" [size]="14" />
      <span>A „Nem osztálytárs" jelölésűek nem számítanak bele a létszámba</span>
    </div>
  }

  <div dialogBody class="participants-content">
    <!-- Loading state -->
    @if (isLoading() && participants().length === 0) {
      <div class="loading-state">
        <div class="loading-spinner"></div>
        <span>Betöltés...</span>
      </div>
    }

    <!-- Empty state -->
    @if (!isLoading() && participants().length === 0) {
      <div class="empty-state">
        <lucide-icon [name]="ICONS.USERS" [size]="48" />
        <p>Még nincs regisztrált résztvevő.</p>
      </div>
    }

    <!-- Participants list -->
    @if (participants().length > 0) {
      <div class="participants-list">
        @for (participant of participants(); track participant.id) {
          <div
            class="participant"
            [ngClass]="[getStatusClass(participant), isCurrentUser(participant) ? 'participant--me' : '']"
          >
            <!-- Status indicator dot -->
            <div class="participant__status-dot"></div>

            <!-- Name and info -->
            <div class="participant__info">
              <div class="participant__name">
                {{ participant.guestName }}
                @if (isCurrentUser(participant)) {
                  <span class="participant__me-badge">(Én)</span>
                }
                @if (getStatusBadge(participant)) {
                  <span class="participant__badge">
                    {{ getStatusBadge(participant) }}
                  </span>
                }
              </div>
              <div class="participant__meta">
                <span class="participant__activity">
                  {{ formatLastActivity(participant.lastActivityAt) }}
                </span>
              </div>
            </div>

            <!-- Votes count -->
            <div class="participant__votes" [title]="participant.votesCount + ' szavazat'">
              <lucide-icon [name]="ICONS.CHECK" [size]="14" />
              <span>{{ participant.votesCount }}</span>
            </div>

            <!-- Extra toggle (only for admins) -->
            @if (hasFullAccess()) {
              <button
                type="button"
                class="participant__extra-toggle"
                [class.participant__extra-toggle--active]="participant.isExtra"
                [class.participant__extra-toggle--loading]="togglingExtraId() === participant.id"
                [disabled]="participant.isBanned || togglingExtraId() === participant.id"
                (click)="onToggleExtra(participant.id)"
                [title]="participant.isExtra ? 'Osztálytársnak jelölés' : 'Nem osztálytársnak jelölés'"
              >
                @if (togglingExtraId() !== participant.id) {
                  <lucide-icon [name]="participant.isExtra ? ICONS.MINUS : ICONS.PLUS" [size]="16" />
                }
                @if (togglingExtraId() === participant.id) {
                  <div class="loading-spinner loading-spinner--sm"></div>
                }
              </button>
            }
          </div>
        }
      </div>
    }
  </div>

  <!-- Footer buttons -->
  <div dialogFooter>
    <button
      type="button"
      class="btn btn--outline"
      (click)="onRefresh()"
      [disabled]="isLoading()"
    >
      @if (!isLoading()) {
        <lucide-icon [name]="ICONS.REFRESH" [size]="18" />
      }
      @if (isLoading()) {
        <div class="loading-spinner loading-spinner--sm"></div>
      }
      <span>Frissítés</span>
    </button>
    <button
      type="button"
      class="btn btn--primary"
      (click)="closeEvent.emit()"
    >
      Bezárás
    </button>
  </div>
</app-dialog-wrapper>
