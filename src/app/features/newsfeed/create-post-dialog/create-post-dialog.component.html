<app-dialog-wrapper
  variant="create"
  headerStyle="hero"
  theme="green"
  [icon]="dialogIcon()"
  [title]="dialogTitle()"
  [description]="dialogDescription()"
  size="lg"
  [isSubmitting]="isSubmitting()"
  [errorMessage]="errorMessage()"
  (closeEvent)="onClose()"
>
  <ng-container dialogBody>
    <!-- Type selector (disabled in edit mode) -->
    <div class="field">
      <label class="field__label">Típus</label>
      <div class="type-selector">
        <button
          type="button"
          class="type-btn"
          [class.type-btn--active]="postType === 'announcement'"
          (click)="onTypeChange('announcement')"
          [disabled]="isSubmitting() || isEditMode()"
        >
          <lucide-icon [name]="ICONS.ACTIVITY" [size]="18" />
          Bejelentés
        </button>
        <button
          type="button"
          class="type-btn"
          [class.type-btn--active]="postType === 'event'"
          (click)="onTypeChange('event')"
          [disabled]="isSubmitting() || isEditMode()"
        >
          <lucide-icon [name]="ICONS.CALENDAR" [size]="18" />
          Esemény
        </button>
      </div>
      @if (isEditMode()) {
        <span class="field__hint">A típus nem módosítható szerkesztéskor.</span>
      }
    </div>

    <!-- Title field -->
    <div class="field">
      <ps-input
        label="Cím"
        [required]="true"
        [(ngModel)]="title"
        (ngModelChange)="onInputChange()"
        [placeholder]="postType === 'event' ? 'Pl.: Osztálykirándulás' : 'Pl.: Fontos bejelentés'"
        [disabled]="isSubmitting()"
        autocomplete="off"
        [errorMessage]="errors.title || ''"
      />
      <div class="field__footer">
        @if (!errors.title) {
          <span class="field__char-count">{{ titleCharCount() }}</span>
        }
      </div>
    </div>

    <!-- Event details (only for events) -->
    @if (postType === 'event') {
    <div class="event-details">
      <!-- Event date -->
      <div class="field field--half">
        <ps-datepicker
          label="Dátum"
          [required]="true"
          [(ngModel)]="eventDate"
          (ngModelChange)="onInputChange()"
          [min]="minDate()"
          [disabled]="isSubmitting()"
          [errorMessage]="errors.eventDate || ''"
        />
      </div>

      <!-- Event time -->
      <div class="field field--half">
        <ps-timepicker
          label="Időpont (opcionális)"
          [(ngModel)]="eventTime"
          (ngModelChange)="onInputChange()"
          [disabled]="isSubmitting()"
        />
      </div>

      <!-- Event location -->
      <div class="field">
        <ps-input
          label="Helyszín (opcionális)"
          [(ngModel)]="eventLocation"
          (ngModelChange)="onInputChange()"
          placeholder="Pl.: Eger, Dobó tér"
          [disabled]="isSubmitting()"
        />
      </div>
    </div>
    }

    <!-- Content field -->
    <div class="field">
      <label class="field__label" for="post-content">
        Tartalom <span class="field__optional">(opcionális)</span>
      </label>
      <app-rich-text-editor
        [(ngModel)]="content"
        name="richContent"
        mode="standard"
        placeholder="Írd le a részleteket..."
        [disabled]="isSubmitting()"
        [minHeight]="120"
        [maxHeight]="200"
        (textLengthChangeEvent)="onContentTextLengthChange($event)"
      />
      <div class="field__footer">
        @if (errors.content) {
          <span class="field__error">{{ errors.content }}</span>
        } @else {
          <span class="field__char-count">{{ contentTextLength }}/5000</span>
        }
      </div>
    </div>

    <!-- Media Editor Component -->
    <div class="field">
      <app-media-editor
        [existingMedia]="existingMediaItems()"
        [maxFiles]="validator.maxFiles"
        [maxSizeMB]="10"
        [disabled]="isSubmitting()"
        [existingLabel]="'Meglévő képek/videók'"
        [newLabel]="isEditMode() ? 'Új képek/videók hozzáadása' : 'Képek/Videók'"
        (newFilesChange)="onNewFilesChange($event)"
        (mediaToDeleteChange)="onMediaToDeleteChange($event)"
        (error)="onMediaError($event)"
      />
      @if (errors.media) {
        <span class="field__error">{{ errors.media }}</span>
      }
    </div>

  </ng-container>

  <ng-container dialogFooter>
    <button
      type="button"
      class="btn btn--secondary"
      (click)="onClose()"
      [disabled]="isSubmitting()"
    >
      Mégse
    </button>

    <button
      type="button"
      class="btn btn--confirm"
      (click)="submit()"
      [disabled]="!isFormValid() || isSubmitting()"
    >
      @if (isSubmitting()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="18" class="spin" />
      } @else if (!isEditMode()) {
        <lucide-icon [name]="ICONS.SEND" [size]="18" />
      } @else {
        <lucide-icon [name]="ICONS.SAVE" [size]="18" />
      }
      {{ submitButtonText() }}
    </button>
  </ng-container>
</app-dialog-wrapper>
