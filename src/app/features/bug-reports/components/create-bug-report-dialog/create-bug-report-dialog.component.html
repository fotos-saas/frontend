<app-dialog-wrapper
  headerStyle="flat"
  theme="red"
  [icon]="ICONS.BUG"
  title="Új hibajelentés"
  size="lg"
  [closable]="!submitting()"
  [isSubmitting]="submitting()"
  [errorMessage]="error()"
  variant="create"
  (closeEvent)="close.emit()"
  (submitEvent)="submit()"
>
  <div dialogBody>
    <!-- Cím -->
    <ps-input
      label="Cím"
      [required]="true"
      placeholder="Rövid leírás a hibáról..."
      [ngModel]="title()"
      (ngModelChange)="title.set($event)"
    />

    <!-- Leírás -->
    <div class="form-field">
      <label>Leírás <span class="required">*</span></label>
      <app-rich-text-editor
        [ngModel]="description()"
        (ngModelChange)="description.set($event)"
        mode="standard"
        placeholder="Részletes leírás... (lépések a hiba reprodukálásához)"
      />
    </div>

    <!-- Prioritás -->
    <ps-select
      label="Prioritás"
      [options]="prioritySelectOptions"
      [ngModel]="priority()"
      (ngModelChange)="priority.set($event)"
    />

    <!-- Mellékletek -->
    <div class="form-field">
      <label>
        <lucide-icon [name]="ICONS.PAPERCLIP" [size]="14" />
        Képek (max 5, max 5 MB/kép)
      </label>
      <div class="attachments-area">
        @if (attachments().length > 0) {
          <div class="attachment-list">
            @for (file of attachments(); track $index) {
              <div class="attachment-item" [class.attachment-item--fresh]="freshIndex() === $index">
                <lucide-icon [name]="ICONS.IMAGE" [size]="14" class="attachment-icon" />
                <span class="attachment-name">{{ file.name }}</span>
                <button class="attachment-remove" (click)="removeAttachment($index)">
                  <lucide-icon [name]="ICONS.X" [size]="14" />
                </button>
              </div>
            }
          </div>
        }
        @if (attachments().length < 5) {
          <label class="upload-btn">
            <lucide-icon [name]="ICONS.UPLOAD" [size]="16" />
            Kép feltöltése
            <input
              type="file"
              accept="image/jpeg,image/png,image/gif,image/webp"
              multiple
              (change)="onFileSelect($event)"
              hidden
            />
          </label>
          <p class="paste-hint">Tipp: Ctrl+V a vágólapról is beilleszthetsz képet!</p>
        }
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div dialogFooter>
    <button class="btn-cancel" (click)="close.emit()" [disabled]="submitting()">
      Mégse
    </button>
    <button
      class="btn-submit"
      (click)="submit()"
      [disabled]="submitting() || !title().trim() || !description().trim()"
    >
      @if (submitting()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="16" class="spin" />
        Küldés...
      } @else {
        <lucide-icon [name]="ICONS.SEND" [size]="16" />
        Bejelentés küldése
      }
    </button>
  </div>
</app-dialog-wrapper>
