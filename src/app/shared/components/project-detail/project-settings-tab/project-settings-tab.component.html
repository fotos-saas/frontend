<app-info-box storageKey="settings-tab" title="Beállítások" [showRestore]="false">
  Itt szabhatod testre a projekt működését: retusálható képek száma, módosítási időablak és export beállítások.
  Ha nem adsz meg egyedi értéket, a globális beállítások érvényesülnek.
</app-info-box>

@if (loading()) {
  <div class="flex items-center justify-center py-12">
    <div class="w-8 h-8 border-3 border-gray-200 border-t-primary rounded-full animate-spin"></div>
  </div>
} @else {
  <div class="settings-section">
    <div class="section-header">
      <lucide-icon [name]="ICONS.IMAGE" [size]="20" />
      <h3>Képválasztás beállítások</h3>
      @if (!infoBox()?.visible()) {
        <button class="info-restore-btn" (click)="infoBox()?.restore()" matTooltip="Beállítások info">
          <lucide-icon [name]="ICONS.HELP_CIRCLE" [size]="15" />
        </button>
      }
    </div>

    <div class="setting-card">
      <div class="setting-row">
        <div class="setting-info">
          <span class="setting-label">Retusálható képek száma</span>
          <span class="setting-description">
            Hány képet választhat ki egy diák retusálásra ebben a projektben.
          </span>
        </div>
      </div>

      <!-- Toggle -->
      <label class="toggle-row">
        <input
          type="checkbox"
          class="toggle-input"
          [checked]="useCustomLimit()"
          (change)="toggleCustomLimit()"
        />
        <span class="toggle-label">Egyedi limit beállítása erre a projektre</span>
      </label>

      @if (useCustomLimit()) {
        <div class="number-input-row">
          <label class="number-label" for="maxRetouch">Maximum képek száma</label>
          <input
            id="maxRetouch"
            type="number"
            class="number-input"
            min="1"
            max="20"
            [ngModel]="customLimit()"
            (ngModelChange)="customLimit.set($event)"
          />
        </div>
      }

      <div class="info-row">
        <lucide-icon [name]="ICONS.INFO" [size]="14" class="info-icon" />
        <span>
          Globális alapérték: <strong>{{ globalDefault() }} kép</strong>
          @if (useCustomLimit()) {
            &middot; Érvényes érték: <strong>{{ customLimit() }} kép</strong>
          }
        </span>
      </div>

    </div>

    <!-- Free Edit Window Setting -->
    <div class="setting-card">
      <div class="setting-row">
        <div class="setting-info">
          <span class="setting-label">Ingyenes módosítási időablak</span>
          <span class="setting-description">
            Mennyi ideig módosíthatja a diák a véglegesített választását díjmentesen.
          </span>
        </div>
      </div>

      <label class="toggle-row">
        <input
          type="checkbox"
          class="toggle-input"
          [checked]="useCustomEditWindow()"
          (change)="toggleCustomEditWindow()"
        />
        <span class="toggle-label">Egyedi érték beállítása erre a projektre</span>
      </label>

      @if (useCustomEditWindow()) {
        <div class="number-input-row">
          <label class="number-label" for="editWindow">Időablak (óra)</label>
          <input
            id="editWindow"
            type="number"
            class="number-input"
            min="1"
            max="168"
            [ngModel]="customEditWindowHours()"
            (ngModelChange)="customEditWindowHours.set($event)"
          />
        </div>
      }

      <div class="info-row">
        <lucide-icon [name]="ICONS.INFO" [size]="14" class="info-icon" />
        <span>
          Globális alapérték: <strong>{{ globalDefaultEditWindow() }} óra</strong>
          @if (useCustomEditWindow()) {
            &middot; Érvényes érték: <strong>{{ customEditWindowHours() }} óra</strong>
          }
        </span>
      </div>
    </div>

    <!-- Export beállítások -->
    <div class="section-header section-header--mt">
      <lucide-icon [name]="ICONS.DOWNLOAD" [size]="20" />
      <h3>Export beállítások</h3>
    </div>

    <div class="setting-card">
      <div class="setting-row">
        <div class="setting-info">
          <span class="setting-label">Letöltési beállítások</span>
          <span class="setting-description">
            ZIP tartalom, fájlnév stratégia és párbeszédablak beállítások erre a projektre.
          </span>
        </div>
      </div>

      <label class="toggle-row">
        <input
          type="checkbox"
          class="toggle-input"
          [checked]="useCustomExport()"
          (change)="toggleCustomExport()"
        />
        <span class="toggle-label">Egyedi export beállítás erre a projektre</span>
      </label>

      @if (useCustomExport()) {
        <div class="sub-settings">
          <div class="number-input-row">
            <label class="number-label" for="exportZipContent">ZIP tartalom</label>
            <select
              id="exportZipContent"
              class="select-input"
              [ngModel]="exportZipContent()"
              (ngModelChange)="exportZipContent.set($event)"
            >
              <option value="all">Összes kép</option>
              <option value="retouch_and_tablo">Retusált + Tablókép</option>
              <option value="retouch_only">Csak retusált</option>
              <option value="tablo_only">Csak tablókép</option>
            </select>
          </div>
          <div class="number-input-row">
            <label class="number-label" for="exportFileNaming">Fájlnév stratégia</label>
            <select
              id="exportFileNaming"
              class="select-input"
              [ngModel]="exportFileNaming()"
              (ngModelChange)="exportFileNaming.set($event)"
            >
              <option value="original">Eredeti fájlnév</option>
              <option value="student_name">Diák neve</option>
              <option value="student_name_iptc">IPTC beágyazás</option>
            </select>
          </div>
          <label class="toggle-row">
            <input
              type="checkbox"
              class="toggle-input"
              [checked]="exportAlwaysAsk()"
              (change)="exportAlwaysAsk.set(!exportAlwaysAsk())"
            />
            <span class="toggle-label">Mindig kérdezzen rá letöltésnél</span>
          </label>
        </div>
      }

      <div class="info-row">
        <lucide-icon [name]="ICONS.INFO" [size]="14" class="info-icon" />
        <span>
          Globális: <strong>{{ globalDefaultZipContent() === 'all' ? 'Összes kép' : globalDefaultZipContent() === 'retouch_only' ? 'Csak retusált' : globalDefaultZipContent() === 'tablo_only' ? 'Csak tablókép' : 'Retusált + Tablókép' }}</strong>
        </span>
      </div>
    </div>

    <!-- Közös Mentés gomb -->
    <div class="action-row">
      <button
        class="save-btn"
        [disabled]="saving()"
        (click)="save()"
      >
        @if (saving()) {
          <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
        }
        Mentés
      </button>
    </div>
  </div>
}
