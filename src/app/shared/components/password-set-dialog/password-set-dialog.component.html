<app-dialog-wrapper
  variant="edit"
  headerStyle="hero"
  theme="purple"
  [icon]="ICONS.LOCK"
  title="Jelszó beállítása"
  description="A fiókod biztonsága érdekében állíts be egy erős jelszót. Ezt a jelszót fogod használni a jövőbeni bejelentkezésekhez."
  size="md"
  [closable]="false"
  [isSubmitting]="isSubmitting()"
  [errorMessage]="errorMessage()"
>
  <ng-container dialogBody>
    <!-- Password field -->
    <div class="field">
      <label class="field__label" for="password">
        Jelszó <span class="field__required">*</span>
      </label>
      <div class="field__input-wrapper">
        <input
          [type]="showPassword() ? 'text' : 'password'"
          id="password"
          class="field__input field__input--with-toggle"
          [class.field__input--error]="errors.password"
          [(ngModel)]="password"
          (ngModelChange)="onInputChange()"
          placeholder="Minimum 8 karakter"
          [disabled]="isSubmitting()"
          autocomplete="new-password"
        />
        <button
          type="button"
          class="field__toggle-btn"
          (click)="togglePasswordVisibility()"
          [attr.aria-label]="showPassword() ? 'Jelszó elrejtése' : 'Jelszó megjelenítése'"
        >
          <lucide-icon [name]="showPassword() ? ICONS.EYE_OFF : ICONS.EYE" [size]="20" />
        </button>
      </div>
      @if (errors.password) {
        <span class="field__error" role="alert" aria-live="polite">{{ errors.password }}</span>
      }

      <!-- Password strength indicator (compact mode) -->
      <app-password-strength [password]="password" [compact]="true" />
    </div>

    <!-- Password confirmation field -->
    <div class="field">
      <label class="field__label" for="password-confirmation">
        Jelszó megerősítése <span class="field__required">*</span>
      </label>
      <div class="field__input-wrapper">
        <input
          [type]="showPasswordConfirmation() ? 'text' : 'password'"
          id="password-confirmation"
          class="field__input field__input--with-toggle"
          [class.field__input--error]="errors.passwordConfirmation"
          [(ngModel)]="passwordConfirmation"
          (ngModelChange)="onInputChange()"
          placeholder="Írd be újra a jelszót"
          [disabled]="isSubmitting()"
          autocomplete="new-password"
        />
        <button
          type="button"
          class="field__toggle-btn"
          (click)="toggleConfirmationVisibility()"
          [attr.aria-label]="showPasswordConfirmation() ? 'Jelszó elrejtése' : 'Jelszó megjelenítése'"
        >
          <lucide-icon [name]="showPasswordConfirmation() ? ICONS.EYE_OFF : ICONS.EYE" [size]="20" />
        </button>
      </div>
      @if (errors.passwordConfirmation) {
        <span class="field__error" role="alert" aria-live="polite">{{ errors.passwordConfirmation }}</span>
      }

      <!-- Match indicator -->
      @if (password && passwordConfirmation && password === passwordConfirmation) {
        <span class="field__success">
          <lucide-icon [name]="ICONS.CHECK" [size]="16" />
          A jelszavak megegyeznek
        </span>
      }
    </div>

  </ng-container>

  <ng-container dialogFooter>
    <button
      type="button"
      class="btn btn--primary btn--full"
      (click)="submit()"
      [disabled]="!isFormValid || isSubmitting()"
    >
      @if (isSubmitting()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="20" class="spin" />
        Mentés...
      } @else {
        <lucide-icon [name]="ICONS.CHECK" [size]="20" />
        Jelszó beállítása
      }
    </button>
    <p class="info-text">
      <lucide-icon [name]="ICONS.INFO" [size]="16" />
      A jelszódat biztonságosan tároljuk. Ha elfelejted, bármikor kérhetsz újat.
    </p>
    <div class="logout-section">
      <button type="button" class="logout-btn" (click)="doLogout()">
        Kilépés
      </button>
    </div>
  </ng-container>
</app-dialog-wrapper>
