<div
  class="person-card"
  [class.person-card--no-photo]="!person().hasPhoto"
  [class.person-card--clickable]="person().photoUrl || person().photoThumbUrl"
  [style.animation-delay]="animationDelay()"
  (click)="onCardClick()"
>
  <div class="card-photo">
    <button
      class="id-badge"
      type="button"
      (click)="copyId($event)"
      [matTooltip]="idCopied() ? 'Másolva!' : 'ID: ' + person().id"
    >{{ person().id }}</button>
    @if (person().photoThumbUrl) {
      <img [src]="person().photoThumbUrl" [alt]="person().name" loading="lazy" />
      <div class="card-zoom-icon">
        <lucide-icon [name]="ICONS.ZOOM_IN" [size]="16" />
      </div>
      <!-- photo_type badge — csak fotós kártyáknál -->
      @if (person().type === 'teacher' && person().photoType) {
        <div
          class="photo-type-badge"
          [class.photo-type-badge--camera]="person().photoType === 'with_photo'"
          [class.photo-type-badge--pen]="person().photoType === 'name_only'"
          [matTooltip]="person().photoType === 'with_photo' ? 'Fotóval' : 'Csak név'"
        >
          <lucide-icon [name]="person().photoType === 'with_photo' ? ICONS.CAMERA : ICONS.EDIT" [size]="12" />
        </div>
      }
    } @else {
      <div class="card-placeholder">
        <lucide-icon [name]="ICONS.USER_X" [size]="24" />
      </div>
    }
  </div>

  <div class="card-info">
    <span class="card-name">{{ person().name }}</span>
    <div class="card-meta">
      <span class="card-type" [class.card-type--teacher]="person().type === 'teacher'">
        @if (person().type === 'teacher' && person().title) {
          {{ person().title }}
        } @else {
          {{ person().type === 'student' ? 'Diák' : 'Tanár' }}
        }
      </span>
      @if (person().linkedGroup) {
        <span class="card-badge card-badge--linked" matTooltip="Összekapcsolva">
          <lucide-icon [name]="ICONS.LINK" [size]="10" />
        </span>
      }
      @if (person().hasOverride) {
        <span class="card-badge card-badge--override" matTooltip="Csak ezen a tablón egyedi">Egyedi</span>
      }
    </div>
    @if (person().type === 'teacher' && person().archiveId) {
      <div class="card-actions">
        <button type="button" class="card-action-btn" matTooltip="Összekapcsolás" (click)="linkClick.emit(person()); $event.stopPropagation()">
          <lucide-icon [name]="ICONS.LINK" [size]="12" />
        </button>
        @if (person().linkedGroup) {
          <button type="button" class="card-action-btn" matTooltip="Fotó csere archívumból" (click)="photoChooserClick.emit(person()); $event.stopPropagation()">
            <lucide-icon [name]="ICONS.IMAGE" [size]="12" />
          </button>
        }
      </div>
    }
  </div>
</div>
