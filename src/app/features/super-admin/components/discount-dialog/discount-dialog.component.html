<app-dialog-wrapper
  [variant]="currentDiscount() ? 'edit' : 'create'"
  headerStyle="hero"
  theme="amber"
  [icon]="ICONS.PERCENT"
  [title]="currentDiscount() ? 'Kedvezmény módosítása' : 'Kedvezmény beállítása'"
  [description]="subscriberName()"
  size="md"
  [closable]="!isSubmitting()"
  [isSubmitting]="isSubmitting()"
  [errorMessage]="errorMessage()"
  (closeEvent)="onCancel()"
  (submitEvent)="onSubmit()"
>
  <ng-container dialogBody>
    <!-- Százalék -->
    <ps-input
      type="number"
      label="Kedvezmény mértéke (%)"
      [ngModel]="percent()"
      (ngModelChange)="percent.set($event)"
      [min]="1"
      [max]="99"
      [required]="true"
      placeholder="pl. 20"
    />
    @if (percent() > 0 && percent() <= 99) {
      <span class="ps-field__hint">{{ percent() }}% kedvezmény minden számlából</span>
    }

    <!-- Időtartam típus -->
    <ps-radio-group
      label="Érvényesség"
      [options]="durationOptions"
      [ngModel]="durationType()"
      (ngModelChange)="durationType.set($event)"
      direction="horizontal"
    />

    <!-- Hónapok száma -->
    @if (durationType() === 'months') {
      <ps-input
        type="number"
        label="Hónapok száma"
        [ngModel]="durationMonths()"
        (ngModelChange)="durationMonths.set($event)"
        [min]="1"
        [max]="120"
        [required]="true"
        placeholder="pl. 6"
      />
      @if (durationMonths() > 0) {
        <span class="ps-field__hint">{{ formatExpiryDate() }}-ig érvényes</span>
      }
    }

    <!-- Megjegyzés -->
    <ps-textarea
      label="Megjegyzés (opcionális)"
      [ngModel]="note()"
      (ngModelChange)="note.set($event)"
      [maxLength]="500"
      [rows]="3"
      placeholder="pl. Hűségkedvezmény, egyedi megállapodás..."
    />

    @if (currentDiscount()) {
      <div class="info-box">
        <lucide-icon [name]="ICONS.INFO" [size]="16" />
        <span>A jelenlegi {{ currentDiscount() }}% kedvezmény felülírásra kerül.</span>
      </div>
    }
  </ng-container>

  <ng-container dialogFooter>
    <button
      type="button"
      class="btn btn--outline"
      (click)="onCancel()"
      [disabled]="isSubmitting()"
    >
      Mégse
    </button>
    <button
      type="button"
      class="btn btn--warning"
      (click)="onSubmit()"
      [disabled]="isSubmitting() || !isFormValid()"
    >
      @if (isSubmitting()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="16" class="spin" />
      }
      Mentés
    </button>
  </ng-container>
</app-dialog-wrapper>
