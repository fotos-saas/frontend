<div [ngClass]="hostClasses()">
  <!-- Label -->
  @if (label()) {
    <label class="ps-field__label">
      {{ label() }}
      @if (required()) {
        <span class="ps-field__required">*</span>
      }
      @if (files().length > 0) {
        <span class="ps-upload__count">({{ files().length }} fájl kiválasztva)</span>
      }
    </label>
  }

  <!-- Dropzone -->
  @if (canAddMore()) {
    <div
      class="ps-upload__zone"
      [class.ps-upload__zone--active]="isDragging()"
      [class.ps-upload__zone--disabled]="isDisabled()"
      [class.ps-upload__zone--compact]="variant() === 'compact'"
      [class.ps-upload__zone--error]="computedState() === 'error'"
      [class.ps-upload__zone--has-files]="files().length > 0"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
      (click)="fileInput.click()"
    >
      <input
        #fileInput
        type="file"
        [accept]="accept()"
        [multiple]="multiple()"
        [disabled]="isDisabled()"
        (change)="onFileInputChange($event)"
        class="ps-upload__input"
      />

      <div class="ps-upload__content">
        <div class="ps-upload__icon" [class.ps-upload__icon--active]="isDragging()">
          <lucide-icon [name]="ICONS.UPLOAD" [size]="variant() === 'compact' ? 20 : 28" />
        </div>
        <div class="ps-upload__text-group">
          <span class="ps-upload__text">{{ resolvedDropzoneText() }}</span>
          <span class="ps-upload__subtext">{{ resolvedDropzoneHint() }}</span>
        </div>
      </div>
    </div>
  }

  <!-- Preview lista -->
  @if (files().length > 0) {
    <div class="ps-upload__previews" [class.ps-upload__previews--compact]="variant() === 'compact'">
      @for (preview of files(); track preview.previewUrl || preview.name; let i = $index) {
        <div class="ps-upload__preview">
          @if (preview.previewUrl) {
            <img
              [src]="preview.previewUrl"
              [alt]="preview.name"
              class="ps-upload__thumb"
              loading="lazy"
            />
          } @else {
            <div class="ps-upload__thumb ps-upload__thumb--placeholder">
              <lucide-icon [name]="ICONS.FILE" [size]="20" />
            </div>
          }
          <div class="ps-upload__file-info">
            <span class="ps-upload__file-name" [title]="preview.name">{{ preview.name }}</span>
            <span class="ps-upload__file-size">{{ preview.size }}</span>
          </div>
          <button
            type="button"
            class="ps-upload__remove"
            (click)="removeFile(i); $event.stopPropagation()"
            [disabled]="isDisabled()"
            aria-label="Fájl eltávolítása"
          >
            <lucide-icon [name]="ICONS.X" [size]="14" />
          </button>
        </div>
      }

      <!-- Összes törlése -->
      @if (files().length > 1) {
        <button
          type="button"
          class="ps-upload__clear-all"
          (click)="clearAll()"
          [disabled]="isDisabled()"
        >
          <lucide-icon [name]="ICONS.X_CIRCLE" [size]="14" />
          Összes törlése
        </button>
      }
    </div>
  }

  <!-- Limit elérve -->
  @if (!canAddMore() && files().length > 0) {
    <div class="ps-upload__limit-reached">
      <lucide-icon [name]="ICONS.CHECK_CIRCLE" [size]="14" />
      <span>Maximum {{ multiple() ? maxFiles() : 1 }} fájl feltöltve</span>
    </div>
  }

  <!-- Error -->
  @if (computedState() === 'error' && errorMessage()) {
    <div class="ps-field__error" role="alert">
      <lucide-icon [name]="ICONS.ALERT_CIRCLE" [size]="14" />
      {{ errorMessage() }}
    </div>
  }

  <!-- Hint -->
  @if (hint() && computedState() !== 'error') {
    <div class="ps-field__hint">
      {{ hint() }}
    </div>
  }
</div>
