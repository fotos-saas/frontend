<app-dialog-wrapper
  headerStyle="flat"
  theme="red"
  [icon]="ICONS.BUG"
  title="Új hibajelentés"
  size="lg"
  [closable]="!submitting()"
  [isSubmitting]="submitting()"
  [errorMessage]="error()"
  variant="create"
  (closeEvent)="close.emit()"
  (submitEvent)="submit()"
>
  <div dialogBody>
    <!-- Cím -->
    <ps-input
      label="Cím"
      [required]="true"
      placeholder="Rövid leírás a hibáról..."
      [ngModel]="title()"
      (ngModelChange)="title.set($event)"
    />

    <!-- Leírás -->
    <div class="form-field">
      <label>Leírás <span class="required">*</span></label>
      <app-rich-text-editor
        [ngModel]="description()"
        (ngModelChange)="description.set($event)"
        mode="standard"
        placeholder="Részletes leírás... (lépések a hiba reprodukálásához)"
      />
    </div>

    <!-- Prioritás -->
    <ps-select
      label="Prioritás"
      [options]="prioritySelectOptions"
      [ngModel]="priority()"
      (ngModelChange)="priority.set($event)"
    />

    <!-- Mellékletek -->
    <ps-file-upload
      label="Képek (max 5, max 5 MB/kép)"
      accept=".jpg,.jpeg,.png,.gif,.webp"
      acceptLabel="JPEG, PNG, GIF, WebP"
      [maxFiles]="5"
      [maxSizeMB]="5"
      dropzoneText="Húzd ide a képeket vagy kattints a tallózáshoz"
      [ngModel]="attachments()"
      (ngModelChange)="attachments.set($event)"
      (uploadError)="onUploadError($event)"
    />
  </div>

  <!-- Footer -->
  <div dialogFooter>
    <button class="btn-cancel" (click)="close.emit()" [disabled]="submitting()">
      Mégse
    </button>
    <button
      class="btn-submit"
      (click)="submit()"
      [disabled]="submitting() || !title().trim() || !description().trim()"
    >
      @if (submitting()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="16" class="spin" />
        Küldés...
      } @else {
        <lucide-icon [name]="ICONS.SEND" [size]="16" />
        Bejelentés küldése
      }
    </button>
  </div>
</app-dialog-wrapper>
