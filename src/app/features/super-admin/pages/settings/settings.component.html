<div class="settings-page page-card">
  <header class="page-header">
    <div class="header-content">
      <h1>Beállítások</h1>
      <p class="subtitle">Rendszer konfigurációk és információk</p>
    </div>
  </header>

  <!-- Tab navigáció -->
  <div class="tabs">
    @for (tab of tabs; track tab.id) {
      <button
        type="button"
        class="tab-btn"
        [class.tab-btn--active]="activeTab() === tab.id"
        (click)="setActiveTab(tab.id)"
      >
        <lucide-icon [name]="tab.icon" [size]="18" />
        <span>{{ tab.label }}</span>
      </button>
    }
  </div>

  <!-- Tab tartalom -->
  @if (loading()) {
    <div class="loading-state">
      <div class="skeleton-card skeleton-shimmer"></div>
      <div class="skeleton-card skeleton-shimmer"></div>
    </div>
  } @else if (settings(); as s) {
    <div class="tab-content">
      <!-- Rendszer beállítások -->
      @if (activeTab() === 'system') {
        <div class="settings-section">
          <h2 class="section-title">Rendszer beállítások</h2>

          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Regisztráció engedélyezése</label>
              <span class="setting-description">Új felhasználók regisztrálhatnak a rendszerbe</span>
            </div>
            <ps-toggle
              [ngModel]="registrationEnabled()"
              (ngModelChange)="registrationEnabled.set($event)"
            />
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Próbaidőszak napokban</label>
              <span class="setting-description">Új regisztrációk próbaidőszakának hossza</span>
            </div>
            <ps-input
              type="number"
              size="sm"
              [ngModel]="trialDays()"
              (ngModelChange)="trialDays.set($event)"
              [min]="0"
              [max]="90"
            />
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Alapértelmezett csomag</label>
              <span class="setting-description">Új regisztrációk alapértelmezett csomagja</span>
            </div>
            <ps-select
              size="sm"
              [options]="planSelectOptions()"
              [ngModel]="defaultPlan()"
              (ngModelChange)="defaultPlan.set($event)"
            />
          </div>

          <div class="actions">
            <button
              type="button"
              class="btn-primary"
              [disabled]="saving()"
              (click)="saveSettings()"
            >
              @if (saving()) {
                <lucide-icon [name]="ICONS.LOADER" [size]="18" class="spin" />
                Mentés...
              } @else {
                <lucide-icon [name]="ICONS.CHECK" [size]="18" />
                Mentés
              }
            </button>
          </div>
        </div>
      }

      <!-- Email beállítások -->
      @if (activeTab() === 'email') {
        <div class="settings-section">
          <h2 class="section-title">Email beállítások</h2>
          <p class="section-description">Az email beállítások környezeti változókból kerülnek betöltésre.</p>

          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">SMTP Host</span>
              <span class="info-value">{{ s.email.host || 'Nincs megadva' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">SMTP Port</span>
              <span class="info-value">{{ s.email.port || 'Nincs megadva' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">SMTP Felhasználó</span>
              <span class="info-value">{{ s.email.username || 'Nincs megadva' }}</span>
            </div>
          </div>
        </div>

        <!-- Email fejlesztési mód -->
        <div class="settings-section email-dev-section">
          <h2 class="section-title">Email fejlesztési mód</h2>
          <p class="section-description">Ha aktív, az összes kimenő email a megadott master címre kerül átirányításra (kivéve a whitelist-en szereplők). Ez a beállítás az egész rendszerre hat — a partner saját dev módja felett áll.</p>

          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Fejlesztési mód</label>
              <span class="setting-description">Kimenő emailek átirányítása a master címre</span>
            </div>
            <ps-toggle
              [ngModel]="emailDevMode()"
              (ngModelChange)="emailDevMode.set($event)"
            />
          </div>

          @if (emailDevMode()) {
            <div class="setting-item">
              <div class="setting-info">
                <label class="setting-label">Master email cím</label>
                <span class="setting-description">Ide érkeznek az átirányított emailek</span>
              </div>
              <ps-input
                type="email"
                size="sm"
                placeholder="dev@example.com"
                [ngModel]="emailDevMasterAddress()"
                (ngModelChange)="emailDevMasterAddress.set($event)"
              />
            </div>

            <div class="setting-item setting-item--vertical">
              <div class="setting-info">
                <label class="setting-label">Whitelist</label>
                <span class="setting-description">Ezekre a címekre továbbra is az eredeti címre megy az email</span>
              </div>
              <ps-tag-input
                [ngModel]="emailDevWhitelist()"
                (ngModelChange)="emailDevWhitelist.set($event)"
                placeholder="Email cím hozzáadása..."
              />
            </div>
          }

          <div class="actions">
            <button
              type="button"
              class="btn-primary"
              [disabled]="savingEmailDev()"
              (click)="saveEmailDevSettings()"
            >
              @if (savingEmailDev()) {
                <lucide-icon [name]="ICONS.LOADER" [size]="18" class="spin" />
                Mentés...
              } @else {
                <lucide-icon [name]="ICONS.CHECK" [size]="18" />
                Mentés
              }
            </button>
          </div>
        </div>

        <!-- Teszt email küldése -->
        <div class="settings-section">
          <h2 class="section-title">Teszt email küldése</h2>
          <p class="section-description">Tetszőleges email küldése az SMTP beállítások teszteléséhez.</p>

          @if (emailDevMode()) {
            <div class="dev-mode-notice">
              <lucide-icon [name]="ICONS.INFO" [size]="16" />
              <span>A dev mód aktív — az email a master címre ({{ emailDevMasterAddress() }}) fog érkezni, kivéve ha a címzett a whitelist-en van.</span>
            </div>
          }

          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Címzett</label>
              <span class="setting-description">Az email címzettje</span>
            </div>
            <ps-input
              type="email"
              size="sm"
              placeholder="valaki@example.com"
              [ngModel]="testRecipient()"
              (ngModelChange)="testRecipient.set($event)"
            />
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Tárgy</label>
              <span class="setting-description">Az email tárgya</span>
            </div>
            <ps-input
              type="text"
              size="sm"
              placeholder="Teszt email"
              [ngModel]="testSubject()"
              (ngModelChange)="testSubject.set($event)"
            />
          </div>

          <div class="setting-item setting-item--vertical">
            <div class="setting-info">
              <label class="setting-label">Üzenet</label>
              <span class="setting-description">Az email szövegtörzse</span>
            </div>
            <ps-textarea
              [rows]="4"
              [maxLength]="10000"
              placeholder="Üzenet szövege..."
              [ngModel]="testBody()"
              (ngModelChange)="testBody.set($event)"
            />
          </div>

          <div class="actions">
            <button
              type="button"
              class="btn-primary"
              [disabled]="sendingTest() || !testRecipient() || !testSubject() || !testBody()"
              (click)="sendTestEmail()"
            >
              @if (sendingTest()) {
                <lucide-icon [name]="ICONS.LOADER" [size]="18" class="spin" />
                Küldés...
              } @else {
                <lucide-icon [name]="ICONS.SEND" [size]="18" />
                Teszt email küldése
              }
            </button>
          </div>
        </div>
      }

      <!-- Stripe beállítások -->
      @if (activeTab() === 'stripe') {
        <div class="settings-section">
          <h2 class="section-title">Stripe beállítások</h2>
          <p class="section-description">A Stripe beállítások környezeti változókból kerülnek betöltésre.</p>

          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Publikus kulcs</span>
              <span class="info-value info-value--masked">{{ s.stripe.publicKey || 'Nincs megadva' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Webhook konfigurálva</span>
              <span class="info-value">
                @if (s.stripe.webhookConfigured) {
                  <span class="status-indicator status-indicator--green">Igen</span>
                } @else {
                  <span class="status-indicator status-indicator--red">Nem</span>
                }
              </span>
            </div>
          </div>
        </div>
      }

      <!-- Rendszer infó -->
      @if (activeTab() === 'info') {
        <div class="settings-section">
          <h2 class="section-title">Rendszer információk</h2>

          <div class="info-grid info-grid--wide">
            <div class="info-item">
              <span class="info-label">App verzió</span>
              <span class="info-value">{{ s.info.appVersion }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Laravel verzió</span>
              <span class="info-value">{{ s.info.laravelVersion }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">PHP verzió</span>
              <span class="info-value">{{ s.info.phpVersion }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Környezet</span>
              <span class="info-value">
                <span
                  class="env-badge"
                  [class.env-badge--production]="s.info.environment === 'production'"
                  [class.env-badge--staging]="s.info.environment === 'staging'"
                  [class.env-badge--local]="s.info.environment === 'local'"
                >
                  {{ s.info.environment }}
                </span>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Cache driver</span>
              <span class="info-value">{{ s.info.cacheDriver }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Queue driver</span>
              <span class="info-value">{{ s.info.queueDriver }}</span>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
