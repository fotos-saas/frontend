<app-dialog-wrapper
  variant="create"
  headerStyle="hero"
  theme="blue"
  [icon]="ICONS.FOLDER_PLUS"
  title="Új projekt létrehozása"
  description="Add meg a projekt alapadatait"
  size="md"
  [closable]="!submitting()"
  [errorMessage]="error()"
  (closeEvent)="close.emit()"
  (submitEvent)="onSubmit()"
>
  <ng-container dialogBody>
    <!-- Iskola kiválasztás -->
    <div class="form-group">
      <label class="form-label">Iskola</label>
      <app-searchable-dropdown
        placeholder="Keress iskola név vagy város alapján..."
        addLabel="Új iskola hozzáadása"
        [options]="schoolOptions()"
        [loading]="schoolsLoading()"
        [selectedItem]="selectedSchoolOption()"
        (searchChange)="onSchoolSearch($event)"
        (itemSelected)="onSchoolSelected($event)"
        (cleared)="clearSchool()"
        (addNew)="openAddSchoolModal()"
      />
    </div>

    <!-- Kapcsolattartó -->
    <div class="form-group">
      <label class="form-label">Kapcsolattartó</label>
      <app-searchable-dropdown
        placeholder="Keress kapcsolattartó név, email vagy telefon alapján..."
        addLabel="Új kapcsolattartó hozzáadása"
        [options]="contactOptions()"
        [loading]="contactsLoading()"
        [selectedItem]="selectedContactOption()"
        (searchChange)="onContactSearch($event)"
        (itemSelected)="onContactSelected($event)"
        (cleared)="clearContact()"
        (addNew)="openAddContactModal()"
      />
    </div>

    <!-- Osztály és Évfolyam -->
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Osztály neve</label>
        <input
          type="text"
          placeholder="pl. 12.A"
          [(ngModel)]="formData.class_name"
          name="className"
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label class="form-label">Évfolyam</label>
        <input
          type="text"
          placeholder="pl. 2024"
          [(ngModel)]="formData.class_year"
          name="classYear"
          class="form-input"
        />
      </div>
    </div>
  </ng-container>

  <ng-container dialogFooter>
    <button type="button" class="btn btn--outline" (click)="close.emit()" [disabled]="submitting()">
      Mégse
    </button>
    <button type="button" class="btn btn--primary" [disabled]="submitting()" (click)="onSubmit()">
      @if (submitting()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="16" class="spin" />
        Létrehozás...
      } @else {
        <lucide-icon [name]="ICONS.CHECK" [size]="18" />
        Projekt létrehozása
      }
    </button>
  </ng-container>
</app-dialog-wrapper>

<!-- Add School Modal -->
@if (showAddSchoolModal()) {
  <app-add-school-modal
    (close)="closeAddSchoolModal()"
    (schoolCreated)="onSchoolCreated($event)"
  />
}

<!-- Add Contact Modal -->
@if (showAddContactModal()) {
  <app-add-contact-modal
    (close)="closeAddContactModal()"
    (contactCreated)="onContactCreated($event)"
  />
}
