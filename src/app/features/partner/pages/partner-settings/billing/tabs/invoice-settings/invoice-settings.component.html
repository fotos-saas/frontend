@if (loading()) {
  <div class="skeleton-container">
    <div class="skeleton-row"></div>
    <div class="skeleton-row"></div>
    <div class="skeleton-row"></div>
  </div>
} @else {
  <!-- Provider választás -->
  <div class="settings-section">
    <div class="section-title">
      <lucide-icon [name]="ICONS.RECEIPT" [size]="18" />
      <h2>Szolgáltató</h2>
    </div>

    <div class="setting-card">
      <div class="setting-row">
        <div class="setting-info">
          <span class="setting-label">Számlázási szolgáltató</span>
          <span class="setting-description">Válaszd ki a számlázáshoz használt szolgáltatót.</span>
        </div>
        <div class="setting-control">
          <ps-select

            [options]="providerOptions"
            [ngModel]="provider()"
            (ngModelChange)="onProviderChange($event)" />
        </div>
      </div>

      <div class="sub-setting">
        <div class="setting-row">
          <div class="setting-info">
            <span class="setting-label">Számlázás bekapcsolva</span>
            <span class="setting-description">Ha aktív, a rendszer a kiválasztott szolgáltatón keresztül állít ki számlákat.</span>
          </div>
          <div class="setting-control">
            <ps-toggle
              [ngModel]="enabled()"
              (ngModelChange)="enabled.set($event)" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- API hozzáférés -->
  <div class="settings-section">
    <div class="section-title">
      <lucide-icon [name]="ICONS.KEY" [size]="18" />
      <h2>API hozzáférés</h2>
    </div>

    <div class="setting-card">
      <div class="setting-row">
        <div class="setting-info">
          <span class="setting-label">API kulcs</span>
          <span class="setting-description">
            @if (hasApiKey()) {
              Az API kulcs már be van állítva. Adj meg újat ha módosítani szeretnéd.
            } @else {
              Add meg a {{ PROVIDER_LABELS[provider()] }} API kulcsot.
            }
          </span>
        </div>
        <div class="setting-control api-key-control">
          <ps-input

            type="password"
            placeholder="API kulcs..."
            [ngModel]="apiKey()"
            (ngModelChange)="apiKey.set($event)" />
          <button
            class="validate-btn"
            (click)="validateApiKey()"
            [disabled]="validating() || !hasApiKey()"
          >
            @if (validating()) {
              <lucide-icon [name]="ICONS.LOADER" [size]="14" class="animate-spin" />
            }
            Ellenőrzés
          </button>
        </div>
      </div>
      @if (apiKeyValid() !== null) {
        <div class="api-key-status" [class.api-key-status--valid]="apiKeyValid()" [class.api-key-status--invalid]="!apiKeyValid()">
          <lucide-icon [name]="apiKeyValid() ? ICONS.CHECK : ICONS.X" [size]="14" />
          {{ apiKeyValid() ? 'Érvényes API kulcs' : 'Érvénytelen API kulcs' }}
        </div>
      }
    </div>
  </div>

  <!-- Provider-specifikus beállítások -->
  @if (provider() === 'szamlazz_hu') {
    <div class="settings-section">
      <div class="section-title">
        <lucide-icon [name]="ICONS.BANKNOTE" [size]="18" />
        <h2>Számlázz.hu beállítások</h2>
      </div>

      <div class="setting-card">
        <ps-input
          label="Bank neve"
          placeholder="pl. OTP Bank"
          [ngModel]="szamlazzBankName()"
          (ngModelChange)="szamlazzBankName.set($event)" />
        <ps-input
          label="Bankszámlaszám"
          placeholder="pl. 11773016-01234567-00000000"
          [ngModel]="szamlazzBankAccount()"
          (ngModelChange)="szamlazzBankAccount.set($event)" />
        <ps-input
          label="Válasz email cím"
          type="email"
          placeholder="pl. szamlazas@cegem.hu"
          [ngModel]="szamlazzReplyEmail()"
          (ngModelChange)="szamlazzReplyEmail.set($event)" />
      </div>
    </div>
  }

  @if (provider() === 'billingo') {
    <div class="settings-section">
      <div class="section-title">
        <lucide-icon [name]="ICONS.BANKNOTE" [size]="18" />
        <h2>Billingo beállítások</h2>
      </div>

      <div class="setting-card">
        <ps-input
          label="Számlatömb azonosító"
          placeholder="pl. 12345"
          [ngModel]="billingoBlockId()"
          (ngModelChange)="billingoBlockId.set($event)" />
        <ps-input
          label="Bankszámla azonosító"
          placeholder="pl. 67890"
          [ngModel]="billingoBankAccountId()"
          (ngModelChange)="billingoBankAccountId.set($event)" />
      </div>
    </div>
  }

  <!-- Alapértelmezések -->
  <div class="settings-section">
    <div class="section-title">
      <lucide-icon [name]="ICONS.SETTINGS" [size]="18" />
      <h2>Számla alapértelmezések</h2>
    </div>

    <div class="setting-card">
      <div class="form-row">
        <ps-input
          label="Számla előtag"
          [ngModel]="prefix()"
          (ngModelChange)="prefix.set($event)" />
        <ps-select
          label="Pénznem"
          [options]="currencyOptions"
          [ngModel]="currency()"
          (ngModelChange)="currency.set($event)" />
      </div>
      <div class="form-row">
        <ps-select
          label="Nyelv"
          [options]="languageOptions"
          [ngModel]="language()"
          (ngModelChange)="language.set($event)" />
        <ps-input
          label="Fizetési határidő (nap)"
          type="number"
          [min]="0"
          [max]="365"
          [ngModel]="dueDays()"
          (ngModelChange)="dueDays.set($event)" />
      </div>
      <div class="form-row">
        <ps-input
          label="ÁFA kulcs (%)"
          type="number"
          [min]="0"
          [max]="100"
          [ngModel]="vatPercentage()"
          (ngModelChange)="vatPercentage.set($event)" />
        <div class="setting-row">
          <div class="setting-info">
            <span class="setting-label setting-label--sub">EU ÁFA</span>
          </div>
          <div class="setting-control">
            <ps-toggle
              [ngModel]="euVat()"
              (ngModelChange)="euVat.set($event)" />
          </div>
        </div>
      </div>
      <ps-textarea
        label="Alapértelmezett megjegyzés"
        [rows]="3"
        placeholder="Megjelenik a számlákon alapértelmezettként..."
        [ngModel]="comment()"
        (ngModelChange)="comment.set($event)" />
    </div>
  </div>

  <!-- Mentés -->
  <div class="action-row">
    <button class="save-btn" (click)="save()" [disabled]="saving()">
      @if (saving()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="16" class="animate-spin" />
      }
      Mentés
    </button>
  </div>
}
