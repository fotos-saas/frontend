<app-dialog-wrapper
  variant="edit"
  headerStyle="hero"
  theme="purple"
  [icon]="ICONS.LOCK"
  title="Jelszó beállítása"
  description="A fiókod biztonsága érdekében állíts be egy erős jelszót. Ezt a jelszót fogod használni a jövőbeni bejelentkezésekhez."
  size="md"
  [closable]="false"
  [isSubmitting]="isSubmitting()"
  [errorMessage]="errorMessage()"
>
  <ng-container dialogBody>
    <!-- Password field -->
    <div class="field">
      <ps-input
        type="password"
        label="Jelszó"
        [required]="true"
        fieldId="password"
        placeholder="Minimum 8 karakter"
        [(ngModel)]="password"
        (ngModelChange)="onInputChange()"
        [disabled]="isSubmitting()"
        autocomplete="new-password"
        [errorMessage]="errors.password ?? ''"
      />

      <!-- Password strength indicator (compact mode) -->
      <app-password-strength [password]="password" [compact]="true" />
    </div>

    <!-- Password confirmation field -->
    <div class="field">
      <ps-input
        type="password"
        label="Jelszó megerősítése"
        [required]="true"
        fieldId="password-confirmation"
        placeholder="Írd be újra a jelszót"
        [(ngModel)]="passwordConfirmation"
        (ngModelChange)="onInputChange()"
        [disabled]="isSubmitting()"
        autocomplete="new-password"
        [errorMessage]="errors.passwordConfirmation ?? ''"
        [state]="password && passwordConfirmation && password === passwordConfirmation ? 'success' : 'default'"
      />

      @if (password && passwordConfirmation && password === passwordConfirmation) {
        <span class="field__success">
          <lucide-icon [name]="ICONS.CHECK" [size]="16" />
          A jelszavak megegyeznek
        </span>
      }
    </div>

  </ng-container>

  <div dialogFooter class="footer-stack">
    <button
      type="button"
      class="btn btn--purple btn--full"
      (click)="submit()"
      [disabled]="!isFormValid || isSubmitting()"
    >
      @if (isSubmitting()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="20" class="spin" />
        Mentés...
      } @else {
        <lucide-icon [name]="ICONS.CHECK" [size]="20" />
        Jelszó beállítása
      }
    </button>
    <p class="info-text">
      <lucide-icon [name]="ICONS.INFO" [size]="16" />
      A jelszódat biztonságosan tároljuk. Ha elfelejted, bármikor kérhetsz újat.
    </p>
    <div class="logout-section">
      <button type="button" class="logout-btn" (click)="doLogout()">
        Kilépés
      </button>
    </div>
  </div>
</app-dialog-wrapper>
