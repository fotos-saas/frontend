<!-- Media Lightbox - Képek nagyított nézete -->
<div
  class="media-lightbox"
  role="dialog"
  aria-modal="true"
  aria-label="Kép nagyítás"
>
  <!-- Overlay háttér -->
  <div
    class="media-lightbox__overlay"
    (click)="onOverlayClick($event)"
    aria-hidden="true"
  ></div>

  <!-- Fő container -->
  @if (currentMedia()) {
    <div
      #lightboxElement
      class="media-lightbox__container"
      tabindex="0"
    >
      <!-- Bezárás gomb -->
      <button
        class="media-lightbox__close"
        (click)="close.emit()"
        aria-label="Bezárás"
        type="button"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <!-- Számláló -->
      @if (media().length > 1) {
        <span class="media-lightbox__counter" aria-live="polite">
          {{ currentIndex() + 1 }} / {{ media().length }}
        </span>
      }

      <!-- Fő kép terület -->
      <div class="media-lightbox__main">
        <!-- Bal nyíl -->
        @if (media().length > 1) {
          <button
            class="media-lightbox__arrow media-lightbox__arrow--prev"
            [class.media-lightbox__arrow--disabled]="!hasPrev()"
            [disabled]="!hasPrev()"
            (click)="prev()"
            aria-label="Előző kép"
            type="button"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
        }

        <!-- Kép wrapper zoom-mal -->
        <div class="media-lightbox__image-wrapper">
          <img
            class="media-lightbox__image"
            [class.media-lightbox__image--changing]="imageChanging()"
            [src]="currentMedia()!.url"
            [alt]="currentMedia()!.fileName"
            [attr.draggable]="false"
            (dragstart)="$event.preventDefault()"
            (selectstart)="$event.preventDefault()"
            appZoom
            #zoomDirective="appZoom"
            [zoomEnabled]="true"
            [zoomConfig]="zoomConfig"
            (zoomChangeEvent)="onZoomChange($event)"
          />

          <!-- Zoom Controls -->
          <div class="media-lightbox__zoom-controls">
            <button
              class="media-lightbox__zoom-btn"
              (click)="zoomOut()"
              [disabled]="currentZoom() <= 1"
              aria-label="Kicsinyítés"
              type="button"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                <line x1="8" y1="11" x2="14" y2="11"></line>
              </svg>
            </button>
            <span class="media-lightbox__zoom-level">{{ (currentZoom() * 100) | number:'1.0-0' }}%</span>
            <button
              class="media-lightbox__zoom-btn"
              (click)="zoomIn()"
              [disabled]="currentZoom() >= 4"
              aria-label="Nagyítás"
              type="button"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                <line x1="11" y1="8" x2="11" y2="14"></line>
                <line x1="8" y1="11" x2="14" y2="11"></line>
              </svg>
            </button>
            <button
              class="media-lightbox__zoom-btn media-lightbox__zoom-btn--reset"
              (click)="resetZoom()"
              [disabled]="currentZoom() === 1"
              aria-label="Visszaállítás"
              type="button"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                <path d="M3 3v5h5"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Jobb nyíl -->
        @if (media().length > 1) {
          <button
            class="media-lightbox__arrow media-lightbox__arrow--next"
            [class.media-lightbox__arrow--disabled]="!hasNext()"
            [disabled]="!hasNext()"
            (click)="next()"
            aria-label="Következő kép"
            type="button"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        }
      </div>

      <!-- Thumbnail galéria -->
      @if (media().length > 1) {
        <div class="media-lightbox__thumbnails">
          @for (item of media(); track trackByMedia($index, item); let i = $index) {
            <button
              class="media-lightbox__thumbnail"
              [class.media-lightbox__thumbnail--active]="i === currentIndex()"
              (click)="navigateTo(i)"
              [attr.aria-label]="'Kép ' + (i + 1)"
              [attr.aria-pressed]="i === currentIndex()"
              type="button"
            >
              <img
                class="media-lightbox__thumbnail-image"
                [src]="item.url"
                [alt]="item.fileName"
                [attr.draggable]="false"
              />
            </button>
          }
        </div>
      }
    </div>
  }
</div>
