<!-- Fejléc: keresés + Új minta gomb -->
<div class="samples-header">
  @if (packages().length > 0) {
    <div class="search-box">
      <lucide-icon [name]="ICONS.SEARCH" [size]="16" />
      <input
        type="text"
        placeholder="Keresés cím vagy leírás alapján..."
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
      />
    </div>
  }
  <button class="btn-add" (click)="addNewSample()">
    <lucide-icon [name]="ICONS.PLUS" [size]="16" />
    Új minta
  </button>
</div>

<!-- Loading -->
@if (loading()) {
  <div class="loading-state">
    @for (i of [1,2,3]; track i) {
      <div class="skeleton-row skeleton-shimmer"></div>
    }
  </div>
} @else if (packages().length === 0) {
  <!-- Üres állapot -->
  <div class="empty-state">
    <div class="empty-icon">
      <lucide-icon [name]="ICONS.PALETTE" [size]="48" />
    </div>
    <h3>Nincsenek minták</h3>
    <p>Hozz létre egy mintát a képek megosztásához.</p>
  </div>
} @else {
  <!-- Nincs találat -->
  @if (searchQuery() && filteredPackages().length === 0) {
    <div class="empty-state">
      <p>Nincs találat: <strong>{{ searchQuery() }}</strong></p>
    </div>
  }

  <!-- Kompakt lista -->
  <div class="samples-list">
    @for (pkg of filteredPackages(); track pkg.id; let i = $index) {
      <div class="sample-card" [style.animation-delay]="i * 0.03 + 's'">
        <!-- Fejléc sor: dátum + verzió szám + műveletek -->
        <div class="sample-header">
          <span class="sample-date">{{ pkg.createdAt | date:'yyyy. MM. dd. HH:mm' }}</span>
          <span class="sample-versions">{{ pkg.versionsCount }} verzió</span>
          <div class="sample-actions" (click)="$event.stopPropagation()">
            <button class="action-btn" matTooltip="Új verzió" (click)="openNewVersionDialog(pkg.id)">
              <lucide-icon [name]="ICONS.PLUS" [size]="14" />
            </button>
            <button class="action-btn" matTooltip="Szerkesztés" (click)="openEditPackageDialog(pkg)">
              <lucide-icon [name]="ICONS.EDIT" [size]="14" />
            </button>
            <button class="action-btn action-btn--danger" matTooltip="Törlés" (click)="confirmDeletePackage(pkg)">
              <lucide-icon [name]="ICONS.DELETE" [size]="14" />
            </button>
          </div>
        </div>

        <!-- Verziók - mindig látszanak -->
        @if (pkg.versions.length > 0) {
          <div class="versions-strip">
            @for (ver of pkg.versions; track ver.id) {
              <div class="version-item" (click)="openEditVersionDialog(pkg.id, ver)">
                <div class="version-thumb">
                  @if (ver.images.length > 0) {
                    <img [src]="ver.images[0].thumbUrl" [alt]="'v' + ver.versionNumber"  loading="lazy" />
                    @if (ver.images.length > 1) {
                      <span class="thumb-count">+{{ ver.images.length - 1 }}</span>
                    }
                  } @else {
                    <div class="thumb-placeholder">
                      <lucide-icon [name]="ICONS.IMAGE" [size]="16" />
                    </div>
                  }
                </div>
                <div class="version-detail">
                  <div class="version-top">
                    <span class="version-badge">v{{ ver.versionNumber }}</span>
                    <span class="version-date">{{ ver.createdAt | date:'MM.dd. HH:mm' }}</span>
                  </div>
                  @if (ver.description) {
                    <p class="version-desc">{{ ver.description }}</p>
                  }
                </div>
                <button
                  class="action-btn action-btn--danger action-btn--sm"
                  matTooltip="Verzió törlés"
                  (click)="$event.stopPropagation(); confirmDeleteVersion(pkg.id, ver)"
                >
                  <lucide-icon [name]="ICONS.DELETE" [size]="12" />
                </button>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>
}
