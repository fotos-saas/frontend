<div class="stripe-settings">
  @if (stripeService.loading()) {
    <div class="loading-state">
      <div class="skeleton-row skeleton-shimmer"></div>
      <div class="skeleton-row skeleton-shimmer"></div>
    </div>
  } @else {
    <div class="setting-section">
      <h3>Stripe API kulcsok</h3>
      <p class="section-desc">Add meg a Stripe fiókod API kulcsait a vendégek online fizetésének fogadásához.</p>

      <ps-input
        label="Publikus kulcs (pk_...)"
        fieldId="pk"
        type="text"
        [(ngModel)]="publicKey"
        [placeholder]="stripeService.settings()?.has_public_key ? '••••••••••• (már megadva)' : 'pk_live_... vagy pk_test_...'"
      />

      <ps-input
        label="Titkos kulcs (sk_...)"
        fieldId="sk"
        type="password"
        [(ngModel)]="secretKey"
        [placeholder]="stripeService.settings()?.has_secret_key ? '••••••••••• (már megadva)' : 'sk_live_... vagy sk_test_...'"
      />

      <ps-input
        label="Webhook secret (whsec_...)"
        fieldId="wh"
        type="password"
        [(ngModel)]="webhookSecret"
        [placeholder]="stripeService.settings()?.has_webhook_secret ? '••••••••••• (már megadva)' : 'whsec_...'"
      />

      @if (stripeService.settings(); as settings) {
        <div class="form-field">
          <label>Webhook URL (másold be a Stripe dashboardba)</label>
          <div class="webhook-url">
            <code>{{ settings.webhook_url }}</code>
          </div>
        </div>
      }
    </div>

    <div class="setting-section">
      <ps-toggle
        label="Online fizetés engedélyezése"
        hint="Ha be van kapcsolva, a vendégek online fizethetnek a terheléseikre."
        [(ngModel)]="stripeEnabled"
      />
    </div>

    <div class="actions-bar">
      <button class="btn btn-outline" (click)="validateKeys()" [disabled]="stripeService.validating()">
        <lucide-icon [name]="ICONS.SHIELD_CHECK" [size]="16" />
        {{ stripeService.validating() ? 'Ellenőrzés...' : 'Kulcsok validálása' }}
      </button>
      <button class="btn btn-primary" (click)="save()" [disabled]="stripeService.loading()">
        <lucide-icon [name]="ICONS.SAVE" [size]="16" />
        Mentés
      </button>
    </div>

    @if (validationResult(); as result) {
      <div class="alert" [class.alert--success]="result.valid" [class.alert--error]="!result.valid">
        <lucide-icon [name]="result.valid ? ICONS.CHECK_CIRCLE : ICONS.ALERT_CIRCLE" [size]="16" />
        {{ result.message }}
      </div>
    }

    @if (saved()) {
      <div class="alert alert--success">
        <lucide-icon [name]="ICONS.CHECK_CIRCLE" [size]="16" />
        Stripe beállítások mentve.
      </div>
    }

    @if (stripeService.error(); as errorMsg) {
      <div class="alert alert--error">
        <lucide-icon [name]="ICONS.ALERT_CIRCLE" [size]="16" />
        {{ errorMsg }}
      </div>
    }
  }
</div>
