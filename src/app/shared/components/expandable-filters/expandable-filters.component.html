<div class="expandable-filters">
  <!-- Látható szűrők (első N db) - inline -->
  @for (filter of visibleFilters(); track filter.id) {
    <div class="filter-item" [class.filter-item--with-icon]="filter.icon">
      @if (filter.icon) {
        <lucide-icon [name]="filter.icon" [size]="14" class="filter-icon" />
      }
      <select
        (change)="onFilterSelectChange(filter.id, $event)"
        class="filter-select"
        [class.filter-select--with-icon]="filter.icon"
      >
        <option value="" [selected]="!getFilterValue(filter.id)">{{ filter.label }}</option>
        @for (opt of filter.options; track opt.value) {
          <option [value]="opt.value" [selected]="getFilterValue(filter.id) === opt.value">{{ opt.label }}</option>
        }
      </select>
    </div>
  }

  <!-- "További szűrők" gomb + dropdown (ha van rejtett) -->
  @if (hasHiddenFilters()) {
    <div class="more-filters-wrapper">
      <button
        type="button"
        class="more-filters-btn"
        [class.more-filters-btn--active]="expanded() || activeHiddenCount() > 0"
        (click)="toggleExpanded($event)"
      >
        <lucide-icon [name]="ICONS.FILTER" [size]="14" />
        <span class="more-filters-btn__text">További</span>
        @if (activeHiddenCount() > 0) {
          <span class="active-dot"></span>
        }
        <lucide-icon
          [name]="expanded() ? ICONS.CHEVRON_UP : ICONS.CHEVRON_DOWN"
          [size]="12"
          class="more-filters-btn__chevron"
        />
      </button>

      <!-- Dropdown panel - gomb alatt jelenik meg -->
      @if (expanded()) {
        <div class="filters-dropdown" (click)="$event.stopPropagation()">
          @for (filter of hiddenFilters(); track filter.id) {
            <div class="dropdown-filter">
              <label class="dropdown-label">{{ filter.label }}</label>
              <select
                (change)="onFilterSelectChange(filter.id, $event)"
                class="dropdown-select"
              >
                <option value="" [selected]="!getFilterValue(filter.id)">Mind</option>
                @for (opt of filter.options; track opt.value) {
                  <option [value]="opt.value" [selected]="getFilterValue(filter.id) === opt.value">{{ opt.label }}</option>
                }
              </select>
            </div>
          }

          <!-- Szűrők törlése gomb -->
          @if (activeHiddenCount() > 0) {
            <button
              type="button"
              class="clear-filters-btn"
              (click)="clearHiddenFilters()"
            >
              <lucide-icon [name]="ICONS.X" [size]="12" />
              Szűrők törlése
            </button>
          }
        </div>
      }
    </div>
  }

  <!-- Összes szűrő törlése gomb (ha van bármelyik aktív) -->
  @if (hasAnyActiveFilter()) {
    <button
      type="button"
      class="clear-all-btn"
      (click)="clearAllFilters($event)"
      matTooltip="Szűrők törlése"
    >
      <lucide-icon [name]="ICONS.X" [size]="14" />
    </button>
  }
</div>
