<div
  class="toolbar"
  [class.toolbar--has-collapse]="openSubmenu()"
  (mouseenter)="onCollapseEnter()"
  (mouseleave)="onCollapseLeave()"
>
  <!-- Drag handle -->
  <div class="toolbar__drag">
    <lucide-icon [name]="ICONS.GRIP" [size]="14" />
  </div>

  <!-- Separator after drag -->
  <div class="toolbar__sep"></div>

  <!-- Toolbar groups -->
  @for (group of groups(); track group.id; let last = $last) {
    @for (item of group.items; track item.id) {
      <div class="toolbar__btn-wrap">
        <button
          class="toolbar__btn"
          [class.toolbar__btn--green]="item.accent === 'green'"
          [class.toolbar__btn--purple]="item.accent === 'purple'"
          [class.toolbar__btn--amber]="item.accent === 'amber'"
          [class.toolbar__btn--red]="item.accent === 'red'"
          [class.toolbar__btn--blue]="item.accent === 'blue'"
          [class.toolbar__btn--busy]="busyCommand() === item.id"
          [class.toolbar__btn--active]="openSubmenu() === item.id"
          [disabled]="busyCommand() === item.id"
          (click)="onCommand(item.id)"
          [title]="item.tooltip || item.label"
        >
          @if (busyCommand() === item.id) {
            <span class="toolbar__spinner"></span>
          } @else {
            <lucide-icon [name]="item.icon" [size]="18" />
          }
        </button>

        <!-- Inline collapse: arrange-names text align opciók -->
        @if (item.id === 'arrange-names') {
          <div
            class="toolbar__inline-collapse"
            [class.toolbar__inline-collapse--open]="openSubmenu() === 'arrange-names'"
          >
            <div class="toolbar__inline-collapse-inner">
              <button class="toolbar__btn toolbar__btn--sm" (click)="arrangeNames('left')" title="Balra igazitas">
                <lucide-icon [name]="ICONS.ALIGN_START_V" [size]="15" />
              </button>
              <button class="toolbar__btn toolbar__btn--sm" (click)="arrangeNames('center')" title="Kozepre igazitas">
                <lucide-icon [name]="ICONS.ALIGN_CENTER_V" [size]="15" />
              </button>
              <button class="toolbar__btn toolbar__btn--sm" (click)="arrangeNames('right')" title="Jobbra igazitas">
                <lucide-icon [name]="ICONS.ALIGN_END_V" [size]="15" />
              </button>
            </div>
          </div>
        }
      </div>
    }
    @if (!last) {
      <div class="toolbar__sep"></div>
    }
  }

  <!-- Spacer -->
  <div class="toolbar__spacer"></div>

  <!-- Active document + selected layers + turbo -->
  @if (activeDocLabel()) {
    <button
      class="toolbar__doc"
      (click)="openActiveDocDir()"
      [title]="activeDoc().path ?? ''"
    >
      <lucide-icon [name]="ICONS.FILE_TEXT" [size]="13" />
      <span class="toolbar__doc-name">{{ activeDocLabel() }}</span>
    </button>
    <span class="toolbar__info">
      <lucide-icon [name]="ICONS.LAYERS" [size]="12" />
      {{ selectedLayers() }}
    </span>
    <div class="toolbar__sep"></div>
  }

  <!-- Turbo gomb -->
  <button
    class="toolbar__btn"
    [class.toolbar__btn--turbo-active]="isTurbo()"
    (click)="toggleTurbo()"
    [title]="isTurbo() ? 'Turbo aktiv (1mp) — katt a kikapcsolashoz' : 'Turbo polling (1mp / 2 percig)'"
  >
    <lucide-icon [name]="ICONS.ZAPS" [size]="16" />
  </button>

  <!-- Hide button -->
  <button class="toolbar__btn toolbar__btn--close" (click)="hide()" title="Elrejtes (Ctrl+K)">
    <lucide-icon [name]="ICONS.X" [size]="16" />
  </button>
</div>
