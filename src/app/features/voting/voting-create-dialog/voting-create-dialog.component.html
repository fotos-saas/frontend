<div class="dialog-overlay" (mousedown)="onBackdropMouseDown($event)" (click)="onBackdropClick($event)">
  <div class="dialog dialog--extra-wide" (click)="$event.stopPropagation()">
    <!-- Header -->
    <header class="dialog__header">
      <h2 class="dialog__title">Új szavazás létrehozása</h2>
      <button
        type="button"
        class="dialog__close"
        (click)="onCancel()"
        aria-label="Bezárás"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </header>

    <!-- Content -->
    <div class="dialog__content">
      <!-- Error message -->
      @if (errorMessage()) {
        <div class="dialog__error">
          {{ errorMessage() }}
        </div>
      }

      <!-- 2 oszlopos elrendezés -->
      <div class="dialog__two-columns">
        <!-- Bal oszlop: Alap adatok -->
        <div class="dialog__column dialog__column--main">
          <!-- Title -->
          <div class="form-group">
            <ps-input
              label="Szavazás címe"
              [required]="true"
              fieldId="poll-title"
              placeholder="Pl. Melyik tabló tetszik?"
              [(ngModel)]="title"
              hint="Min. 3 karakter"
            />
          </div>

          <!-- Description - Rich Text Editor -->
          <div class="form-group">
            <label class="form-label">
              Leírás (opcionális)
            </label>
            <app-rich-text-editor
              [(ngModel)]="description"
              [mode]="'basic'"
              [placeholder]="'Szavazás leírása, részletek...'"
              [minHeight]="100"
              [maxHeight]="200"
            />
          </div>

          <!-- Media Upload (max 5 képek, 10MB/kép) -->
          <div class="form-group">
            <label class="form-label">Képek (opcionális)</label>
            @if (mediaUploadError()) {
              <div class="media-upload-error">{{ mediaUploadError() }}</div>
            }
            <app-media-uploader
              [maxFiles]="5"
              [maxSizeMB]="10"
              [disabled]="isSubmitting()"
              (filesChangeEvent)="onMediaFilesChange($event)"
              (uploadErrorEvent)="onMediaUploadError($event)"
            />
          </div>

          <!-- Deadline -->
          <div class="form-group">
            <label class="form-label">Határidő</label>
            <div class="deadline-options">
              @for (option of deadlineOptions; track option.days) {
                <button
                  type="button"
                  class="deadline-option"
                  [class.deadline-option--selected]="selectedDeadline === option.days"
                  (click)="selectedDeadline = option.days"
                >
                  {{ option.label }}
                </button>
              }
            </div>
            <span class="form-hint">A szavazás automatikusan lezárul a határidő lejártakor</span>
          </div>

          <!-- Settings -->
          <div class="form-group">
            <label class="form-label">Beállítások</label>
            <div class="settings-list">
              <ps-checkbox
                label="Több választás engedélyezése"
                [(ngModel)]="isMultipleChoice"
              />
              <!-- Max votes input - csak ha több választás engedélyezve -->
              @if (isMultipleChoice) {
                <div class="max-votes-row">
                  <ps-input
                    label="Maximum választható"
                    type="number"
                    fieldId="max-votes"
                    [(ngModel)]="maxVotesPerGuest"
                    [min]="1"
                    [max]="options.length > 0 ? options.length : 10"
                    size="sm"
                    hint="db"
                  />
                </div>
              }
              <ps-checkbox
                label="Eredmények mutatása szavazás előtt"
                [(ngModel)]="showResultsBeforeVote"
              />
            </div>
          </div>
        </div>

        <!-- Jobb oszlop: Választási lehetőségek -->
        <div class="dialog__column dialog__column--options">
          <h3 class="dialog__column-title">
            Választási lehetőségek <span class="required">*</span>
          </h3>

          <div class="options-list">
            @for (option of options; track trackByIndex($index); let i = $index) {
              <div class="option-row">
                <span class="option-number">{{ i + 1 }}.</span>
                <ps-input
                  [ngModel]="option"
                  (ngModelChange)="updateOption(i, $event)"
                  placeholder="Opció neve"
                />
                <button
                  type="button"
                  class="option-remove"
                  (click)="removeOption(i)"
                  [disabled]="options.length <= 2"
                  aria-label="Opció eltávolítása"
                >
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                </button>
              </div>
            }
          </div>

          <button
            type="button"
            class="add-option-btn"
            (click)="addOption()"
            [disabled]="options.length >= 10"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
            </svg>
            Opció hozzáadása
          </button>
          <span class="form-hint">Min. 2, max. 10 opció</span>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="dialog__footer">
      <button
        type="button"
        class="btn btn--secondary"
        (click)="onCancel()"
        [disabled]="isSubmitting()"
      >
        Mégse
      </button>
      <button
        type="button"
        class="btn btn--primary"
        (click)="onSubmit()"
        [disabled]="!isValid || isSubmitting()"
      >
        @if (isSubmitting()) {
          <span>Létrehozás...</span>
        } @else {
          <span>Szavazás létrehozása</span>
        }
      </button>
    </footer>
  </div>
</div>
