<div class="finalization-row" (click)="cardClick.emit(item())">
  <!-- Col 1: Minta kép -->
  <div class="col col-sample">
    @if (item().sampleThumbUrl) {
      <img
        [src]="item().sampleThumbUrl"
        alt="Minta"
        class="sample-thumb"
        [class.sample-thumb--clickable]="!!item().samplePreviewUrl"
        loading="lazy"
        (click)="onThumbnailClick($event)" />
    } @else {
      <div class="sample-placeholder">
        <lucide-icon [name]="ICONS.IMAGE" [size]="16" />
      </div>
    }
  </div>

  <!-- Col 2: Iskola / Osztály / Kontakt -->
  <div class="col col-school">
    <span class="school-name">{{ item().schoolName ?? 'Ismeretlen iskola' }}</span>
    <span class="school-meta">{{ item().className ?? '-' }} @if (item().classYear) {({{ item().classYear }})} @if (item().contact) { · {{ item().contact!.name }}}</span>
  </div>

  <!-- Col 3: Véglegesítés dátuma -->
  <div class="col col-date">
    @if (item().orderSubmittedAt) {
      <span class="date-value">{{ item().orderSubmittedAt | date:'yyyy. MMM d.':'':'hu-HU' }}</span>
    } @else {
      <span class="date-empty">-</span>
    }
  </div>

  <!-- Col 4: Tablóméret -->
  <div class="col col-size" (click)="$event.stopPropagation()">
    @if (sizeOptions().length > 0) {
      <ps-select
        size="xs"
        emptyLabel="Méret..."
        [options]="sizeOptions()"
        [ngModel]="item().tabloSize ?? ''"
        (ngModelChange)="onSizeSelected($event)"
      />
    } @else {
      <span class="size-empty">-</span>
    }
  </div>

  <!-- Col 5: Fájl státusz -->
  <div class="col col-file">
    @if (item().printSmallTablo || item().printFlat) {
      <div class="file-badges">
        @if (item().printSmallTablo) {
          <span class="file-badge file-badge--ready" [matTooltip]="'Kistabló: ' + item().printSmallTablo!.fileName">KT</span>
        }
        @if (item().printFlat) {
          <span class="file-badge file-badge--ready" [matTooltip]="'Flat: ' + item().printFlat!.fileName">FL</span>
        }
      </div>
    } @else {
      <span class="file-status file-status--empty">
        <lucide-icon [name]="ICONS.FILE" [size]="12" />
        Nincs fájl
      </span>
    }
  </div>

  <!-- Col 6: Műveletek -->
  <div class="col col-actions">
    @if (item().status === 'in_print') {
      <button
        type="button"
        class="action-btn action-btn--done"
        (click)="onMarkDoneClick($event)"
        matTooltip="Készre állítás"
      >
        <lucide-icon [name]="ICONS.CHECK_CIRCLE" [size]="14" />
      </button>
    }
    @if (item().printFlat) {
      <button
        type="button"
        class="action-btn action-btn--download"
        [class.action-btn--spinning]="downloading()"
        [disabled]="downloading()"
        (click)="onDownloadClick($event)"
        [matTooltip]="downloading() ? 'Letöltés folyamatban...' : 'Flat letöltése'"
      >
        <lucide-icon [name]="downloading() ? ICONS.LOADER : ICONS.DOWNLOAD" [size]="14" />
      </button>
    }
    <button
      type="button"
      class="action-btn action-btn--upload"
      (click)="onUploadClick($event)"
      [matTooltip]="(item().printSmallTablo || item().printFlat) ? 'Fájl cseréje' : 'Fájl feltöltése'"
    >
      <lucide-icon [name]="ICONS.UPLOAD" [size]="14" />
    </button>
  </div>
</div>
