<article
  class="comment-item"
  [class.comment-item--contact]="authorType() === 'contact'"
  [class.comment-item--no-border]="noBorder()"
  [class.comment-item--pinned]="variant() === 'pinned'"
  [class.comment-item--event]="variant() === 'event'"
  [class.comment-item--reply]="isReply()"
  [class.comment-item--new]="isNew()"
>
  <!-- Avatar -->
  <app-post-avatar
    [authorName]="authorName()"
    size="small"
  />

  <!-- Body -->
  <div class="comment-item__body">
    <!-- Bubble: név + idő + tartalom -->
    <div class="comment-item__bubble">
      <!-- Hover actions - jobb felső sarok -->
      @if (canDelete()) {
        <div class="comment-item__hover-actions">
          <button type="button" class="comment-item__hover-btn" (click)="onDeleteClick()" title="Törlés">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <polyline points="3 6 5 6 21 6"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
          </button>
        </div>
      }
      <div class="comment-item__header">
        <span class="comment-item__author">{{ authorName() }}</span>
        <span class="comment-item__time">{{ createdAt() | timeAgo }}</span>
        @if (isEdited()) {
          <span class="comment-item__edited">(szerkesztve)</span>
        }
      </div>
      <span class="comment-item__content">{{ content() }}</span>
    </div>

    <!-- Actions sor: reakció + válasz + X válasz -->
    <div class="comment-item__actions">
      <app-reaction-picker
        [reactions]="showReactions() ? reactions() : {}"
        [userReaction]="showReactions() ? userReaction() : null"
        (reactionSelected)="onReactionSelected($event)"
      />
      @if (showReply()) {
        <button type="button" class="comment-item__action-btn" (click)="onReplyClick()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
          </svg>
          Válasz
        </button>
      }
      @if (repliesCount() > 0) {
        <app-reply-toggle-button
          [count]="repliesCount()"
          [expanded]="repliesExpanded()"
          (clicked)="onToggleReplies()"
        />
      }
    </div>
  </div>
</article>
