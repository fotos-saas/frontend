<!-- Loading -->
@if (loading()) {
  <div class="loading-state">
    @for (i of [1, 2, 3]; track i) {
      <div class="skeleton-timeline skeleton-shimmer"></div>
    }
  </div>
} @else if (days().length === 0) {
  <!-- Empty state -->
  <div class="empty-state">
    <div class="empty-icon">
      <lucide-icon [name]="ICONS.HISTORY" [size]="48" />
    </div>
    <h3>Nincsenek feltöltési előzmények</h3>
    <p>A tanári fotók feltöltése után itt fogod látni az előzményeket.</p>
  </div>
} @else {
  <!-- Timeline -->
  <div class="timeline">
    @for (day of days(); track day.date; let isFirst = $first) {
      <div class="timeline-item" [class.timeline-item--new]="day.isNew">
        <!-- Left: date column -->
        <div class="timeline-date">
          <span class="timeline-day-num">{{ getDayNum(day.date) }}</span>
          <span class="timeline-month">{{ getMonthShort(day.date) }}</span>
          <span class="timeline-weekday">{{ getWeekday(day.date) }}</span>
        </div>

        <!-- Center: dot + line -->
        <div class="timeline-line">
          <div class="timeline-dot" [class.timeline-dot--new]="day.isNew"></div>
        </div>

        <!-- Right: content -->
        <div class="timeline-content">
          <!-- Header row -->
          <div class="timeline-header">
            <div class="timeline-meta">
              <span class="timeline-count">
                <lucide-icon [name]="ICONS.CAMERA" [size]="14" />
                {{ day.uploadCount }} fotó
              </span>
              @if (day.isNew) {
                <span class="new-dot"></span>
              }
            </div>
            <div class="timeline-actions">
              @if (day.isNew) {
                <button
                  type="button"
                  class="tl-btn tl-btn--seen"
                  matTooltip="Láttam"
                  (click)="markSeen(day, $event)"
                  [disabled]="markingDate() === day.date"
                >
                  @if (markingDate() === day.date) {
                    <span class="btn-spinner"></span>
                  } @else {
                    <lucide-icon [name]="ICONS.EYE" [size]="14" />
                  }
                </button>
              }
              <button
                type="button"
                class="tl-btn tl-btn--download"
                matTooltip="Letöltés (ZIP)"
                (click)="downloadZip(day, $event)"
                [disabled]="downloadingDate() === day.date"
              >
                @if (downloadingDate() === day.date) {
                  <span class="btn-spinner"></span>
                } @else {
                  <lucide-icon [name]="ICONS.DOWNLOAD" [size]="14" />
                }
              </button>
            </div>
          </div>

          <!-- Schools compact -->
          @for (school of day.schools; track school.schoolId) {
            <div class="school-row">
              <span class="school-label">{{ school.schoolName }}</span>
              <div class="avatar-stack">
                @for (upload of school.uploads; track upload.teacherId + upload.uploadedAt; let i = $index) {
                  @if (i < 8) {
                    <div
                      class="mini-avatar"
                      [matTooltip]="upload.teacherName"
                    >
                      @if (upload.photoThumbUrl) {
                        <img [src]="upload.photoThumbUrl" [alt]="upload.teacherName" loading="lazy" />
                      } @else {
                        <span class="mini-avatar__initial">{{ getInitial(upload.teacherName) }}</span>
                      }
                    </div>
                  }
                }
                @if (school.uploads.length > 8) {
                  <div class="mini-avatar mini-avatar--more">
                    +{{ school.uploads.length - 8 }}
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
    }
  </div>

  <!-- Pagination -->
  @if (totalPages() > 1) {
    <app-list-pagination
      [currentPage]="currentPage()"
      [totalPages]="totalPages()"
      [totalItems]="totalDays()"
      itemLabel="nap"
      (pageChange)="setPage($event)"
    />
  }
}
