@if (project$ | async; as project) {
  <div class="persons page-card">
    <main id="main-content" class="persons__main" tabindex="-1">
      <!-- Page Header -->
      <header class="persons__header">
        <h1 class="persons__title">Hi√°nyz√≥ k√©pek</h1>
        <p class="persons__subtitle">Az al√°bbi szem√©lyeknek m√©g nincs felt√∂ltve a k√©p√ºk</p>
      </header>

      @if (filteredPersons$ | async; as data) {
        <!-- Stats Banner -->
        @if (project.personStats?.withoutPhoto; as totalMissing) {
          <div class="stats-banner">
            <div class="stats-banner__icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
              </svg>
            </div>
            <div class="stats-banner__content">
              <span class="stats-banner__count">{{ totalMissing }} szem√©lynek nincs k√©pe</span>
              <span class="stats-banner__details">
                {{ data.studentsWithoutPhoto }} di√°k
                @if (data.teachersWithoutPhoto > 0) {
                  <span> ‚Ä¢ {{ data.teachersWithoutPhoto }} tan√°r</span>
                }
              </span>
            </div>
          </div>
        }

        <!-- Empty State - All photos uploaded -->
        @if (project.personStats?.withoutPhoto === 0) {
          <div class="empty-state empty-state--success">
            <div class="empty-state__icon empty-state__icon--success">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h2 class="empty-state__title">Minden szem√©lynek van k√©pe!</h2>
            <p class="empty-state__text">A tabl√≥ k√©sz√≠t√©se megkezd≈ëdhet</p>
          </div>
        }

        <!-- Search and Filter -->
        @if (project.personStats && project.personStats.withoutPhoto > 0) {
          <div class="controls">
            <ps-input
              placeholder="Keres√©s n√©v szerint..."
              [ngModel]="searchQuery()"
              (ngModelChange)="searchQuery.set($event)"
              autocomplete="off"
            />
            <ps-select
              size="sm"
              [options]="filterOptions"
              [ngModel]="filterType()"
              (ngModelChange)="filterType.set($event)"
            />
          </div>
        }

        <!-- Students Section -->
        @if (data.students.length > 0) {
          <section class="person-section">
            <div class="person-section__header">
              <span class="person-section__emoji">üë®‚Äçüéì</span>
              <h2 class="person-section__title">Di√°kok</h2>
              <span class="person-section__count">{{ data.students.length }} f≈ë</span>
            </div>
            <div class="person-grid">
              @for (person of data.students; track person.id) {
                <div class="person-card">
                  <div class="person-card__avatar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                    </svg>
                    <span class="person-card__badge"></span>
                  </div>
                  <div class="person-card__info">
                    <span class="person-card__name">{{ person.name }}</span>
                    @if (person.localId) {
                      <span class="person-card__id">{{ person.localId }}</span>
                    }
                  </div>
                </div>
              }
            </div>
          </section>
        }

        <!-- Teachers Section -->
        @if (data.teachers.length > 0) {
          <section class="person-section">
            <div class="person-section__header">
              <span class="person-section__emoji">üë®‚Äçüè´</span>
              <h2 class="person-section__title">Tan√°rok</h2>
              <span class="person-section__count">{{ data.teachers.length }} f≈ë</span>
            </div>
            <div class="person-grid">
              @for (person of data.teachers; track person.id) {
                <div class="person-card person-card--teacher">
                  <div class="person-card__avatar person-card__avatar--teacher">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                    </svg>
                    <span class="person-card__badge person-card__badge--teacher"></span>
                  </div>
                  <div class="person-card__info">
                    <span class="person-card__name">{{ person.name }}</span>
                    @if (person.localId) {
                      <span class="person-card__id">{{ person.localId }}</span>
                    }
                  </div>
                </div>
              }
            </div>
          </section>
        }

        <!-- No Results State -->
        @if (project.personStats && project.personStats.withoutPhoto > 0 && data.students.length === 0 && data.teachers.length === 0) {
          <div class="empty-state">
            <div class="empty-state__icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
              </svg>
            </div>
            <h2 class="empty-state__title">Nincs tal√°lat</h2>
            <p class="empty-state__text">Pr√≥b√°lj m√°s keres√©si kifejez√©st</p>
          </div>
        }
      }
    </main>
  </div>
}
