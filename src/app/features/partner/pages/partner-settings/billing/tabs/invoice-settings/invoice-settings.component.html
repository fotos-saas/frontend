@if (loading()) {
  <div class="skeleton-container">
    <div class="skeleton-row"></div>
    <div class="skeleton-row"></div>
    <div class="skeleton-row"></div>
  </div>
} @else {
  <!-- Provider választás -->
  <div class="settings-section">
    <div class="section-title">
      <lucide-icon [name]="ICONS.RECEIPT" [size]="18" />
      <h2>Szolgáltató</h2>
    </div>

    <div class="setting-card">
      <div class="setting-row">
        <div class="setting-info">
          <span class="setting-label">Számlázási szolgáltató</span>
          <span class="setting-description">Válaszd ki a számlázáshoz használt szolgáltatót.</span>
        </div>
        <div class="setting-control">
          <select class="select-input" [value]="provider()" (change)="onProviderChange($any($event.target).value)">
            <option value="szamlazz_hu">Számlázz.hu</option>
            <option value="billingo">Billingo</option>
          </select>
        </div>
      </div>

      <div class="sub-setting">
        <div class="setting-row">
          <div class="setting-info">
            <span class="setting-label">Számlázás bekapcsolva</span>
            <span class="setting-description">Ha aktív, a rendszer a kiválasztott szolgáltatón keresztül állít ki számlákat.</span>
          </div>
          <div class="setting-control">
            <button class="toggle-btn" [class.toggle-btn--active]="enabled()" (click)="onToggleEnabled()">
              <span class="toggle-track"><span class="toggle-thumb"></span></span>
              <span class="toggle-label">{{ enabled() ? 'Aktív' : 'Inaktív' }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- API hozzáférés -->
  <div class="settings-section">
    <div class="section-title">
      <lucide-icon [name]="ICONS.KEY" [size]="18" />
      <h2>API hozzáférés</h2>
    </div>

    <div class="setting-card">
      <div class="setting-row">
        <div class="setting-info">
          <span class="setting-label">API kulcs</span>
          <span class="setting-description">
            @if (hasApiKey()) {
              Az API kulcs már be van állítva. Adj meg újat ha módosítani szeretnéd.
            } @else {
              Add meg a {{ PROVIDER_LABELS[provider()] }} API kulcsot.
            }
          </span>
        </div>
        <div class="setting-control api-key-control">
          <input
            type="password"
            class="text-input"
            [value]="apiKey()"
            (input)="apiKey.set($any($event.target).value)"
            placeholder="API kulcs..."
          />
          <button
            class="validate-btn"
            (click)="validateApiKey()"
            [disabled]="validating() || !hasApiKey()"
          >
            @if (validating()) {
              <lucide-icon [name]="ICONS.LOADER" [size]="14" class="animate-spin" />
            }
            Ellenőrzés
          </button>
        </div>
      </div>
      @if (apiKeyValid() !== null) {
        <div class="api-key-status" [class.api-key-status--valid]="apiKeyValid()" [class.api-key-status--invalid]="!apiKeyValid()">
          <lucide-icon [name]="apiKeyValid() ? ICONS.CHECK : ICONS.X" [size]="14" />
          {{ apiKeyValid() ? 'Érvényes API kulcs' : 'Érvénytelen API kulcs' }}
        </div>
      }
    </div>
  </div>

  <!-- Provider-specifikus beállítások -->
  @if (provider() === 'szamlazz_hu') {
    <div class="settings-section">
      <div class="section-title">
        <lucide-icon [name]="ICONS.BANKNOTE" [size]="18" />
        <h2>Számlázz.hu beállítások</h2>
      </div>

      <div class="setting-card">
        <div class="form-group">
          <label class="form-label">Bank neve</label>
          <input
            type="text"
            class="text-input"
            [value]="szamlazzBankName()"
            (input)="szamlazzBankName.set($any($event.target).value)"
            placeholder="pl. OTP Bank"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Bankszámlaszám</label>
          <input
            type="text"
            class="text-input"
            [value]="szamlazzBankAccount()"
            (input)="szamlazzBankAccount.set($any($event.target).value)"
            placeholder="pl. 11773016-01234567-00000000"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Válasz email cím</label>
          <input
            type="email"
            class="text-input"
            [value]="szamlazzReplyEmail()"
            (input)="szamlazzReplyEmail.set($any($event.target).value)"
            placeholder="pl. szamlazas@cegem.hu"
          />
        </div>
      </div>
    </div>
  }

  @if (provider() === 'billingo') {
    <div class="settings-section">
      <div class="section-title">
        <lucide-icon [name]="ICONS.BANKNOTE" [size]="18" />
        <h2>Billingo beállítások</h2>
      </div>

      <div class="setting-card">
        <div class="form-group">
          <label class="form-label">Számlatömb azonosító</label>
          <input
            type="text"
            class="text-input"
            [value]="billingoBlockId()"
            (input)="billingoBlockId.set($any($event.target).value)"
            placeholder="pl. 12345"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Bankszámla azonosító</label>
          <input
            type="text"
            class="text-input"
            [value]="billingoBankAccountId()"
            (input)="billingoBankAccountId.set($any($event.target).value)"
            placeholder="pl. 67890"
          />
        </div>
      </div>
    </div>
  }

  <!-- Alapértelmezések -->
  <div class="settings-section">
    <div class="section-title">
      <lucide-icon [name]="ICONS.SETTINGS" [size]="18" />
      <h2>Számla alapértelmezések</h2>
    </div>

    <div class="setting-card">
      <div class="form-row">
        <div class="form-group form-group--half">
          <label class="form-label">Számla előtag</label>
          <input
            type="text"
            class="text-input"
            [value]="prefix()"
            (input)="prefix.set($any($event.target).value)"
            maxlength="20"
          />
        </div>
        <div class="form-group form-group--half">
          <label class="form-label">Pénznem</label>
          <select class="select-input" [value]="currency()" (change)="currency.set($any($event.target).value)">
            <option value="HUF">HUF</option>
            <option value="EUR">EUR</option>
            <option value="USD">USD</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group form-group--half">
          <label class="form-label">Nyelv</label>
          <select class="select-input" [value]="language()" (change)="language.set($any($event.target).value)">
            <option value="hu">Magyar</option>
            <option value="en">Angol</option>
            <option value="de">Német</option>
          </select>
        </div>
        <div class="form-group form-group--half">
          <label class="form-label">Fizetési határidő (nap)</label>
          <input
            type="number"
            class="number-input"
            [value]="dueDays()"
            (input)="dueDays.set(+$any($event.target).value)"
            min="0"
            max="365"
          />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group form-group--half">
          <label class="form-label">ÁFA kulcs (%)</label>
          <input
            type="number"
            class="number-input"
            [value]="vatPercentage()"
            (input)="vatPercentage.set(+$any($event.target).value)"
            min="0"
            max="100"
          />
        </div>
        <div class="form-group form-group--half">
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label setting-label--sub">EU ÁFA</span>
            </div>
            <div class="setting-control">
              <button class="toggle-btn" [class.toggle-btn--active]="euVat()" (click)="onToggleEuVat()">
                <span class="toggle-track"><span class="toggle-thumb"></span></span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Alapértelmezett megjegyzés</label>
        <textarea
          class="textarea-input"
          rows="3"
          [value]="comment()"
          (input)="comment.set($any($event.target).value)"
          placeholder="Megjelenik a számlákon alapértelmezettként..."
        ></textarea>
      </div>
    </div>
  </div>

  <!-- Mentés -->
  <div class="action-row">
    <button class="save-btn" (click)="save()" [disabled]="saving()">
      @if (saving()) {
        <lucide-icon [name]="ICONS.LOADER" [size]="16" class="animate-spin" />
      }
      Mentés
    </button>
  </div>
}
