<div class="project-row" [class.project-row--finalized]="project().orderSubmittedAt" [class.project-row--preliminary]="project().isPreliminary" (click)="cardClick.emit(project())">
  <!-- Col 1: Minta kép -->
  <div
    class="col col-sample"
    [class.col-sample--clickable]="project().sampleThumbUrl"
    (click)="onSamplesClick($event)"
  >
    @if (project().sampleThumbUrl) {
      <img
        [src]="project().sampleThumbUrl"
        [alt]="'Minta'"
        class="sample-thumb"
       loading="lazy" />
    } @else {
      <div class="sample-placeholder">
        <lucide-icon [name]="ICONS.IMAGE" [size]="16" />
      </div>
    }
  </div>

  <!-- Col 2: Iskola + Osztály + Draft jelző -->
  <div class="col col-school">
    <div class="school-name-row">
      <span class="school-name">{{ project().schoolName ?? 'Ismeretlen iskola' }}</span>
      @if (project().isPreliminary) {
        @if (project().linkedProjectId) {
          <span class="linked-badge" title="Összekapcsolva">
            <lucide-icon [name]="ICONS.LINK" [size]="10" />
            Összekapcsolva
          </span>
        } @else {
          <span class="preliminary-badge" title="Előzetes projekt">
            <lucide-icon [name]="ICONS.CLOCK" [size]="10" />
            Előzetes
          </span>
        }
      }
      @if (project().draftPhotoCount > 0) {
        <span class="draft-badge" [title]="'Véglegesítésre vár: ' + project().draftPhotoCount + ' kép'">
          <lucide-icon [name]="ICONS.UPLOAD" [size]="10" />
          {{ project().draftPhotoCount }}
        </span>
      }
      @if (project().orderSubmittedAt && !isMarketer()) {
        <button
          type="button"
          class="finalized-badge"
          [matTooltip]="'Megrendelés leadva: ' + (project().orderSubmittedAt | date:'yyyy. MMM d.':'':'hu-HU')"
          (click)="onOrderDataClick($event)"
        >
          <lucide-icon [name]="ICONS.CHECK_CIRCLE" [size]="10" />
          <span class="finalized-badge__text">Leadva</span>
        </button>
      }
    </div>
    <span class="school-meta">{{ project().className ?? '-' }} @if (project().classYear) {({{ project().classYear }})}@if (project().contact) {<span class="school-contact-sep"> · </span><span class="school-contact">{{ project().contact!.name }}</span>}</span>
  </div>

  <!-- Col 3: Tudnak róla -->
  <div
    class="col col-aware col-aware--clickable"
    (click)="onAwareClick($event)"
    [attr.title]="project().isAware ? 'Tudnak róla - kattints a módosításhoz' : 'Nem tudnak róla - kattints a módosításhoz'"
  >
    <lucide-icon
      [name]="project().isAware ? ICONS.CHECK_CIRCLE : ICONS.CIRCLE"
      [size]="16"
      [class.aware--yes]="project().isAware"
      [class.aware--no]="!project().isAware"
    />
  </div>

  <!-- Col 4: Státusz -->
  <div class="col col-status" (click)="$event.stopPropagation()">
    @if (project().statusLabel) {
      <app-status-dropdown
        [currentStatus]="project().status ?? 'not_started'"
        [currentLabel]="getShortStatusLabel(project().statusLabel)"
        [currentColor]="project().statusColor ?? 'gray'"
        [shortLabels]="true"
        (statusChange)="onStatusChange($event)"
      />
    }
  </div>

  <!-- Col 5: Hiányzók D:X/T:Y -->
  <div
    class="col col-missing"
    [class.col-missing--danger]="project().missingCount > 0"
    [class.col-missing--clickable]="project().missingCount > 0"
    (click)="onMissingClick($event)"
  >
    <span class="missing-row"><span class="missing-label">D:</span><span class="missing-num" [class.missing-num--active]="project().missingStudentsCount > 0">{{ project().missingStudentsCount }}</span></span>
    <span class="missing-sep">/</span>
    <span class="missing-row"><span class="missing-label">T:</span><span class="missing-num" [class.missing-num--active]="project().missingTeachersCount > 0">{{ project().missingTeachersCount }}</span></span>
  </div>

  <!-- Col 6: Műveletek -->
  <div class="col col-actions">
    @if (project().isPreliminary && !project().linkedProjectId) {
      <button
        type="button"
        class="action-btn action-btn--link"
        (click)="onLinkClick($event)"
        matTooltip="Összekapcsolás"
      >
        <lucide-icon [name]="ICONS.LINK" [size]="14" />
      </button>
    }
    @if (project().hasActiveQrCode) {
      <button
        type="button"
        class="action-btn"
        (click)="onQrClick($event)"
        matTooltip="QR kód"
      >
        <lucide-icon [name]="ICONS.QR_CODE" [size]="14" />
      </button>
    }
    <button
      type="button"
      class="action-btn action-btn--delete"
      (click)="onDeleteClick($event)"
      matTooltip="Projekt törlése"
    >
      <lucide-icon [name]="ICONS.DELETE" [size]="14" />
    </button>
  </div>
</div>
