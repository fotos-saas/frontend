<section class="step-content">
  <h2 class="step-content__title" tabindex="-1">Design beállítások</h2>
  <p class="step-content__description">Válaszd ki a betűtípust, színeket és töltsd fel a kívánt háttérképet.</p>

  <!-- Betűtípus és szín sor -->
  <div class="form-row">
    <!-- Betűtípus -->
    <ps-input
      label="Betűtípus (opcionális)"
      placeholder="Grafikusra bízom"
      [ngModel]="data().fontFamily"
      (ngModelChange)="updateField('fontFamily', $event)"
      (blur)="touched['fontFamily'] = true"
      hint="Google Fonts oldalon kereshetsz betűtípusokat"
    />

    <!-- Betűszín -->
    <div class="form-field">
      <div class="color-input-wrapper">
        <ps-input
          label="Betűszín (opcionális)"
          placeholder="#000000"
          [ngModel]="data().fontColor || '#000000'"
          (ngModelChange)="updateField('fontColor', $event)"
          (blur)="touched['fontColor'] = true"
        />
        <input
          type="color"
          class="color-input__swatch"
          [value]="data().fontColor || '#000000'"
          (input)="updateField('fontColor', $any($event.target).value)"
          aria-label="Szín választó"
        />
      </div>
    </div>
  </div>

  <!-- Rich text editor - Megjegyzés -->
  <div class="form-field">
    <label id="description-label" class="form-label">Megjegyzés, elképzelés (opcionális)</label>
    <div class="editor-container" role="group" aria-labelledby="description-label">
      <ngx-editor-menu [editor]="editor" [toolbar]="editorToolbar"></ngx-editor-menu>
      <ngx-editor
        [editor]="editor"
        [ngModel]="data().description"
        (ngModelChange)="updateDescription($event)"
        [placeholder]="'Írd le részletesen, hogyan képzeled el a tablót. Milyen stílusú legyen? Van-e referencia kép?'"
      ></ngx-editor>
    </div>
    <span class="ps-field__hint">Maximum 5000 karakter</span>
  </div>

  <!-- Fájl feltöltés sor -->
  <div class="form-row">
    <!-- Háttérkép -->
    <div class="form-field">
      <label id="background-label" class="form-label">Háttérkép (opcionális)</label>
      <div class="file-upload" role="group" aria-labelledby="background-label">
        @if (backgroundUploading()) {
          <div class="file-upload__loading" role="status" aria-live="polite">
            <div class="spinner spinner--small" aria-hidden="true"></div>
            <span>Feltöltés...</span>
          </div>
        } @else if (backgroundFileName()) {
          <div class="file-upload__preview">
            <span class="file-upload__filename">{{ backgroundFileName() }}</span>
            <button
              type="button"
              class="file-upload__remove"
              (click)="removeBackgroundImage()"
              aria-label="Háttérkép törlése"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        } @else {
          <label class="file-upload__label" for="background-file-input">
            <input
              type="file"
              id="background-file-input"
              accept=".jpg,.jpeg,.bmp,image/jpeg,image/bmp"
              (change)="onBackgroundFileSelect($event)"
              class="sr-only"
              aria-describedby="background-hint"
            />
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
            </svg>
            <span>Kép feltöltése</span>
          </label>
        }
      </div>
      <span id="background-hint" class="ps-field__hint">JPG, JPEG vagy BMP, max. 16MB</span>
    </div>

    <!-- Csatolmányok -->
    <div class="form-field">
      <label id="attachment-label" class="form-label">Csatolmányok (opcionális)</label>
      <div class="file-upload" role="group" aria-labelledby="attachment-label">
        @if (attachmentUploading()) {
          <div class="file-upload__loading" role="status" aria-live="polite">
            <div class="spinner spinner--small" aria-hidden="true"></div>
            <span>Feltöltés...</span>
          </div>
        } @else {
          <label class="file-upload__label" for="attachment-file-input">
            <input
              type="file"
              id="attachment-file-input"
              accept=".zip,.rar,.7z,application/zip,application/x-zip-compressed,application/x-rar-compressed,application/x-7z-compressed"
              (change)="onAttachmentFileSelect($event)"
              class="sr-only"
              aria-describedby="attachment-hint"
            />
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
            </svg>
            <span>Fájl feltöltése</span>
          </label>
        }
      </div>
      @if (attachmentFileNames().length > 0) {
        <div class="file-list" role="list" aria-label="Feltöltött csatolmányok">
          @for (filename of attachmentFileNames(); track $index) {
            <div class="file-list__item" role="listitem">
              <span class="file-list__filename">{{ filename }}</span>
              <button
                type="button"
                class="file-list__remove"
                (click)="removeAttachment($index)"
                [attr.aria-label]="'Csatolmány törlése: ' + filename"
              >
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          }
        </div>
      }
      <span id="attachment-hint" class="ps-field__hint">ZIP, RAR vagy 7Z, max. 64MB</span>
    </div>
  </div>
</section>
