<div class="max-w-3xl mx-auto page-card">
  <!-- Loading -->
  @if (loading()) {
    <div class="flex flex-col items-center justify-center py-16">
      <div class="w-10 h-10 border-3 border-gray-200 border-t-primary rounded-full animate-spin"></div>
      <p class="mt-4 text-gray-500">Betöltés...</p>
    </div>
  } @else if (projectData()) {
    <!-- Header (mindig látszik) -->
    <app-project-detail-header
      [project]="projectData()"
      [isMarketer]="isMarketer()"
      (back)="goBack()"
      (editProject)="openEditProjectModal()"
      (deleteProject)="confirmDeleteProject()"
    />

    <!-- Tab navigáció -->
    <app-project-detail-tabs
      [activeTab]="activeTab()"
      [hiddenTabs]="hiddenTabs()"
      (tabChange)="changeTab($event)"
    />

    <!-- Tab tartalom -->
    @switch (activeTab()) {
      @case ('overview') {
        <app-project-detail-view
          [project]="projectData()"
          [isMarketer]="isMarketer()"
          (openQrModal)="openQrModal()"
          (openContactModal)="openContactModal($event)"
          (deleteContact)="confirmDeleteContact($event)"
          (openOrderData)="openOrderDataDialog()"
          (createGallery)="createGallery()"
        />
      }
      @case ('users') {
        @defer {
          <app-project-users-tab
            [projectId]="projectData()?.id ?? 0"
            (deleteRequested)="confirmDeleteUser($event)"
          />
        }
      }
      @case ('samples') {
        @defer {
          <app-project-samples-tab
            [projectId]="projectData()?.id ?? 0"
            (packageDialogRequested)="openPackageDialog($event)"
            (versionDialogRequested)="openVersionDialog($event)"
            (deletePackageRequested)="confirmDeletePackage($event)"
            (deleteVersionRequested)="confirmDeleteVersion($event)"
          />
        }
      }
      @case ('settings') {
        @defer {
          <app-project-settings-tab
            [projectId]="projectData()?.id ?? 0"
          />
        }
      }
    }
  } @else {
    <!-- Projekt nem található -->
    <div class="text-center py-16">
      <div class="w-16 h-16 mx-auto mb-3 bg-red-100 rounded-full flex items-center justify-center">
        <lucide-icon [name]="ICONS.X_CIRCLE" [size]="32" class="text-red-500" />
      </div>
      <h3 class="mt-3 text-lg font-medium text-gray-900">Projekt nem található</h3>
      <div class="mt-4">
        <button
          class="px-4 py-2 text-primary hover:bg-primary-50 text-sm font-medium rounded-lg transition-colors"
          (click)="goBack()"
        >
          Vissza a listához
        </button>
      </div>
    </div>
  }
</div>

<!-- QR Code Modal container -->
<ng-container #qrModalContainer></ng-container>

<!-- Contact Editor Modal container -->
<ng-container #contactModalContainer></ng-container>

<!-- Project Edit Modal container -->
<ng-container #projectEditModalContainer></ng-container>

<!-- Order Data Dialog container -->
<ng-container #orderDataDialogContainer></ng-container>

<!-- Delete User Confirmation - page-card-on KÍVÜL -->
@if (showDeleteUserConfirm()) {
  <app-confirm-dialog
    title="Felhasználó törlése"
    [message]="'Biztosan törölni szeretnéd ' + (deletingUser()?.guestName ?? '') + ' felhasználót?'"
    confirmText="Törlés"
    (resultEvent)="onDeleteUserResult($event)"
  />
}

<!-- Delete Contact Confirmation - page-card-on KÍVÜL -->
@if (showDeleteConfirm()) {
  <app-confirm-dialog
    title="Kapcsolattartó törlése"
    [message]="'Biztosan törölni szeretnéd ' + (deletingContact()?.name ?? '') + ' kapcsolattartót?'"
    confirmText="Törlés"
    [isSubmitting]="deleting()"
    (resultEvent)="onDeleteContactResult($event)"
  />
}

<!-- Delete Project Confirmation - page-card-on KÍVÜL -->
@if (showDeleteProjectConfirm()) {
  <app-confirm-dialog
    title="Projekt törlése"
    [message]="'Biztosan törölni szeretnéd a ' + (projectData()?.name ?? '') + ' projektet? Ez a művelet nem visszavonható!'"
    confirmText="Törlés"
    [isSubmitting]="deletingProject()"
    (resultEvent)="onDeleteProjectResult($event)"
  />
}

<!-- Sample Package Dialog - page-card-on KÍVÜL -->
@if (showPackageDialog()) {
  <app-sample-package-dialog
    [projectId]="projectData()?.id ?? 0"
    [editId]="packageDialogData()?.editId ?? null"
    [initialTitle]="packageDialogData()?.initialTitle ?? ''"
    (close)="closePackageDialog()"
    (saved)="onPackageSaved()"
  />
}

<!-- Sample Version Dialog - page-card-on KÍVÜL -->
@if (showVersionDialog()) {
  <app-sample-version-dialog
    [projectId]="projectData()?.id ?? 0"
    [packageId]="versionDialogData()?.packageId ?? null"
    [editVersion]="versionDialogData()?.editVersion ?? null"
    (close)="closeVersionDialog()"
    (saved)="onVersionSaved()"
  />
}

<!-- Delete Package Confirmation - page-card-on KÍVÜL -->
@if (showDeletePackageConfirm()) {
  <app-confirm-dialog
    title="Csomag törlése"
    [message]="'Biztosan törölni szeretnéd a ' + (deletingPackageData()?.title ?? '') + ' csomagot? Az összes verzió is törlődik!'"
    confirmText="Törlés"
    (resultEvent)="onDeletePackageResult($event)"
  />
}

<!-- Delete Version Confirmation - page-card-on KÍVÜL -->
@if (showDeleteVersionConfirm()) {
  <app-confirm-dialog
    title="Verzió törlése"
    [message]="'Biztosan törölni szeretnéd a v' + (deletingVersionData()?.version?.versionNumber ?? '') + ' verziót?'"
    confirmText="Törlés"
    (resultEvent)="onDeleteVersionResult($event)"
  />
}
