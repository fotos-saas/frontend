<div class="dialog-overlay" (mousedown)="onBackdropMouseDown($event)" (click)="onBackdropClick($event)">
  <div class="dialog dialog--extra-wide" (click)="$event.stopPropagation()">
    <!-- Header -->
    <header class="dialog__header">
      <h2 class="dialog__title">Új szavazás létrehozása</h2>
      <button
        type="button"
        class="dialog__close"
        (click)="onCancel()"
        aria-label="Bezárás"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </header>

    <!-- Content -->
    <div class="dialog__content">
      <!-- Error message -->
      @if (errorMessage()) {
        <div class="dialog__error">
          {{ errorMessage() }}
        </div>
      }

      <!-- 2 oszlopos elrendezés -->
      <div class="dialog__two-columns">
        <!-- Bal oszlop: Alap adatok -->
        <div class="dialog__column dialog__column--main">
          <!-- Title -->
          <div class="form-group">
            <label for="poll-title" class="form-label">
              Szavazás címe <span class="required">*</span>
            </label>
            <input
              type="text"
              id="poll-title"
              class="form-input"
              [(ngModel)]="title"
              placeholder="Pl. Melyik tabló tetszik?"
              maxlength="100"
            />
            <span class="form-hint">Min. 3 karakter</span>
          </div>

          <!-- Description - Rich Text Editor -->
          <div class="form-group">
            <label class="form-label">
              Leírás (opcionális)
            </label>
            <app-rich-text-editor
              [(ngModel)]="description"
              [mode]="'basic'"
              [placeholder]="'Szavazás leírása, részletek...'"
              [minHeight]="100"
              [maxHeight]="200"
            />
          </div>

          <!-- Media Upload (max 5 képek, 10MB/kép) -->
          <div class="form-group">
            <label class="form-label">Képek (opcionális)</label>
            @if (mediaUploadError()) {
              <div class="media-upload-error">{{ mediaUploadError() }}</div>
            }
            <app-media-uploader
              [maxFiles]="5"
              [maxSizeMB]="10"
              [disabled]="isSubmitting()"
              (filesChangeEvent)="onMediaFilesChange($event)"
              (uploadErrorEvent)="onMediaUploadError($event)"
            />
          </div>

          <!-- Deadline -->
          <div class="form-group">
            <label class="form-label">Határidő</label>
            <div class="deadline-options">
              @for (option of deadlineOptions; track option.days) {
                <button
                  type="button"
                  class="deadline-option"
                  [class.deadline-option--selected]="selectedDeadline === option.days"
                  (click)="selectedDeadline = option.days"
                >
                  {{ option.label }}
                </button>
              }
            </div>
            <span class="form-hint">A szavazás automatikusan lezárul a határidő lejártakor</span>
          </div>

          <!-- Settings -->
          <div class="form-group">
            <label class="form-label">Beállítások</label>
            <div class="settings-list">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="isMultipleChoice"
                />
                <span class="checkbox-text">Több választás engedélyezése</span>
              </label>
              <!-- Max votes input - csak ha több választás engedélyezve -->
              @if (isMultipleChoice) {
                <div class="max-votes-row">
                  <label for="max-votes" class="max-votes-label">Maximum választható:</label>
                  <input
                    type="number"
                    id="max-votes"
                    class="max-votes-input"
                    [(ngModel)]="maxVotesPerGuest"
                    [min]="1"
                    [max]="options.length > 0 ? options.length : 10"
                  />
                  <span class="max-votes-hint">db</span>
                </div>
              }
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="showResultsBeforeVote"
                />
                <span class="checkbox-text">Eredmények mutatása szavazás előtt</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Jobb oszlop: Választási lehetőségek -->
        <div class="dialog__column dialog__column--options">
          <h3 class="dialog__column-title">
            Választási lehetőségek <span class="required">*</span>
          </h3>

          <div class="options-list">
            @for (option of options; track trackByIndex($index); let i = $index) {
              <div class="option-row">
                <span class="option-number">{{ i + 1 }}.</span>
                <input
                  type="text"
                  class="form-input option-input"
                  [value]="option"
                  (input)="updateOption(i, $any($event.target).value)"
                  placeholder="Opció neve"
                  maxlength="100"
                />
                <button
                  type="button"
                  class="option-remove"
                  (click)="removeOption(i)"
                  [disabled]="options.length <= 2"
                  aria-label="Opció eltávolítása"
                >
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                </button>
              </div>
            }
          </div>

          <button
            type="button"
            class="add-option-btn"
            (click)="addOption()"
            [disabled]="options.length >= 10"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
            </svg>
            Opció hozzáadása
          </button>
          <span class="form-hint">Min. 2, max. 10 opció</span>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="dialog__footer">
      <button
        type="button"
        class="btn btn--secondary"
        (click)="onCancel()"
        [disabled]="isSubmitting()"
      >
        Mégse
      </button>
      <button
        type="button"
        class="btn btn--primary"
        (click)="onSubmit()"
        [disabled]="!isValid || isSubmitting()"
      >
        @if (isSubmitting()) {
          <span>Létrehozás...</span>
        } @else {
          <span>Szavazás létrehozása</span>
        }
      </button>
    </footer>
  </div>
</div>
