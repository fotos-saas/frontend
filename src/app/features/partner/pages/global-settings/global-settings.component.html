<div class="global-settings page-card">
  <div class="page-header">
    <lucide-icon [name]="ICONS.SETTINGS" [size]="24" />
    <h1>Beállítások</h1>
  </div>
  <p class="page-description">
    Az itt megadott értékek alapértelmezésként érvényesülnek minden projektedre.
    Egyedi felülírás a projekt Beállítások fülén lehetséges.
  </p>

  @if (loading()) {
    <div class="flex items-center justify-center py-16">
      <div class="w-8 h-8 border-3 border-gray-200 border-t-primary rounded-full animate-spin"></div>
    </div>
  } @else {
    <div class="settings-section">
      <div class="section-title">
        <lucide-icon [name]="ICONS.IMAGE" [size]="18" />
        <h2>Képválasztás</h2>
      </div>

      <div class="setting-card">
        <div class="setting-row">
          <div class="setting-info">
            <span class="setting-label">Retusálható képek száma</span>
            <span class="setting-description">
              Hány képet választhat ki egy diák retusálásra alapértelmezetten.
              Ez az érték érvényes minden projektre, ahol nincs egyedi beállítás.
            </span>
          </div>
          <div class="setting-control">
            <ps-input
              type="number"
              size="sm"
              suffix="kép"
              min="1"
              max="20"
              [ngModel]="maxRetouchPhotos()"
              (ngModelChange)="maxRetouchPhotos.set($event)"
            />
          </div>
        </div>
      </div>

      <!-- Módosítás díjszabás -->
      <div class="setting-card">
        <div class="setting-row">
          <div class="setting-info">
            <span class="setting-label">Fizetős módosítás</span>
            <span class="setting-description">
              Ha aktív, az ingyenes időablak lejárta után a diák módosításai díjkötelesek lesznek.
              Ha inaktív, a módosítás örökké ingyenes marad.
            </span>
          </div>
          <div class="setting-control">
            <ps-toggle
              [label]="billingEnabled() ? 'Aktív' : 'Inaktív'"
              [ngModel]="billingEnabled()"
              (ngModelChange)="billingEnabled.set($event)"
            />
          </div>
        </div>

        <!-- Ingyenes módosítási időablak (csak ha billing aktív) -->
        @if (billingEnabled()) {
          <div class="sub-setting">
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label setting-label--sub">Ingyenes módosítási időablak</span>
                <span class="setting-description">
                  Mennyi ideig módosíthat a diák díjmentesen a véglegesítés után.
                  0 = nincs ingyenes időablak, azonnal fizetős.
                </span>
              </div>
              <div class="setting-control">
                <ps-input
                  type="number"
                  size="sm"
                  suffix="óra"
                  min="0"
                  max="168"
                  [ngModel]="freeEditWindowHours()"
                  (ngModelChange)="freeEditWindowHours.set($event)"
                />
              </div>
            </div>
          </div>
        }
      </div>

    </div>

    <!-- Export beállítások szekció -->
    <div class="settings-section">
      <div class="section-title">
        <lucide-icon [name]="ICONS.DOWNLOAD" [size]="18" />
        <h2>Export beállítások</h2>
      </div>

      <div class="setting-card">
        <div class="setting-row">
          <div class="setting-info">
            <span class="setting-label">ZIP tartalom alapértelmezés</span>
            <span class="setting-description">
              Milyen képeket tartalmazzon a ZIP letöltés alapértelmezetten.
            </span>
          </div>
          <div class="setting-control">
            <ps-select
              size="md"
              [options]="zipContentOptions"
              [ngModel]="defaultZipContent()"
              (ngModelChange)="defaultZipContent.set($event)"
            />
          </div>
        </div>
      </div>

      <div class="setting-card">
        <div class="setting-row">
          <div class="setting-info">
            <span class="setting-label">Fájlnév stratégia</span>
            <span class="setting-description">
              Hogyan legyenek elnevezve a fájlok a letöltött ZIP-ben.
            </span>
          </div>
          <div class="setting-control">
            <ps-select
              size="md"
              [options]="fileNamingOptions"
              [ngModel]="defaultFileNaming()"
              (ngModelChange)="defaultFileNaming.set($event)"
            />
          </div>
        </div>
      </div>

      <div class="setting-card">
        <div class="setting-row">
          <div class="setting-info">
            <span class="setting-label">Mindig kérdezzen rá</span>
            <span class="setting-description">
              Ha aktív, ZIP letöltésnél mindig megjelenik a beállítás párbeszédablak.
              Ha inaktív, a fenti alapértelmezésekkel tölt le azonnal.
            </span>
          </div>
          <div class="setting-control">
            <ps-toggle
              [label]="exportAlwaysAsk() ? 'Aktív' : 'Inaktív'"
              [ngModel]="exportAlwaysAsk()"
              (ngModelChange)="exportAlwaysAsk.set($event)"
            />
          </div>
        </div>
      </div>

      <div class="action-row">
        <button
          class="save-btn"
          [disabled]="saving()"
          (click)="save()"
        >
          @if (saving()) {
            <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
          }
          Mentés
        </button>
      </div>
    </div>
  }
</div>
